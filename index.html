<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <title>Estado Geral Dos Navios</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            background: rgba(44, 62, 80, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.1) 100%);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 30px;
        }

        .header-logo {
            flex-shrink: 0;
        }

        .header-logo img {
            height: 90px;
            width: auto;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
        }

        .header-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
            padding-right: 90px;
            /* Compensa a largura da logo para centralizar */
        }

        .header h1 {
            font-size: 52px;
            font-weight: 300;
            letter-spacing: 10px;
            color: #ffffff;
            text-transform: uppercase;
            text-align: center;
            margin: 0;
            line-height: 1.15;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .header h1 img.logo-transpetro {
            display: none;
        }

        .header h1 span {
            display: inline;
        }

        .header .subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 15px;
            letter-spacing: 6px;
            text-transform: uppercase;
            font-weight: 300;
            text-align: center;
        }

        /* Botão Home no canto superior direito */
        .home-button-container {
            position: absolute;
            right: 25px;
            top: 25px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-home {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .btn-home:hover {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-home:active {
            transform: scale(0.95);
        }

        .btn-privacy.active {
            background: rgba(231, 76, 60, 0.6);
        }

        .btn-privacy.active:hover {
            background: rgba(231, 76, 60, 0.8);
            box-shadow: 0 4px 20px rgba(231, 76, 60, 0.4);
        }

        .btn-home svg {
            width: 28px;
            height: 28px;
            fill: white;
            transition: all 0.3s ease;
        }

        .btn-home:hover svg {
            transform: scale(1.1);
        }

        .btn-home .tooltip-home {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .btn-home .tooltip-home::before {
            content: "";
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-bottom-color: rgba(0, 0, 0, 0.8);
        }

        .btn-home:hover .tooltip-home {
            opacity: 1;
            visibility: visible;
            bottom: -40px;
        }

        /* Tooltip do botão Home aparece em CIMA */
        #btnHome .tooltip-home {
            bottom: auto;
            top: -35px;
        }

        #btnHome .tooltip-home::before {
            top: auto;
            bottom: -6px;
            border-bottom-color: transparent;
            border-top-color: rgba(0, 0, 0, 0.8);
        }

        #btnHome:hover .tooltip-home {
            bottom: auto;
            top: -40px;
        }

        .filter-dropdown-container {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .filter-dropdown-container.compact-mode {
            margin-bottom: 10px;
            padding-bottom: 10px;
        }

        .filter-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(44, 62, 80, 0.98);
            border: 2px solid rgba(52, 152, 219, 0.8);
            border-radius: 12px;
            padding: 20px;
            z-index: 2000;
            display: none;
            min-width: 300px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        }

        .filter-popup.active {
            display: block;
        }

        .filter-popup-header {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-popup-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-popup-item:hover {
            background: rgba(52, 152, 219, 0.3);
        }

        .filter-popup-item.active {
            background: rgba(52, 152, 219, 0.6);
            font-weight: 600;
        }

        /* Chips de filtro múltiplo */
        .filter-chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .filter-chip {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-chip:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: rgba(52, 152, 219, 0.5);
        }

        .filter-chip.active {
            background: rgba(52, 152, 219, 0.6);
            border-color: #3498db;
            color: #ffffff;
            font-weight: 600;
        }

        .filter-chip .chip-count {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
        }

        .filter-chip.active .chip-count {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Chips de grupo (Longo Curso / Cabotagem) */
        .filter-chip.grupo {
            border-style: dashed;
            border-color: rgba(255, 193, 7, 0.4);
            color: rgba(255, 193, 7, 0.9);
            font-style: italic;
        }

        .filter-chip.grupo:hover {
            background: rgba(255, 193, 7, 0.15);
            border-color: rgba(255, 193, 7, 0.7);
        }

        .filter-chip.grupo.active {
            background: rgba(255, 193, 7, 0.25);
            border-color: rgba(255, 193, 7, 0.9);
            color: #ffc107;
        }

        .filter-chip.grupo.active .chip-count {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Separador entre grupos e classes individuais */
        .filter-chips-separator {
            width: 100%;
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 2px 0;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .filter-btn-apply {
            flex: 1;
            padding: 10px;
            background: rgba(39, 174, 96, 0.7);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .filter-btn-apply:hover {
            background: rgba(39, 174, 96, 1);
        }

        .filter-btn-clear {
            padding: 10px 15px;
            background: rgba(127, 140, 141, 0.5);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .filter-btn-clear:hover {
            background: rgba(127, 140, 141, 0.8);
        }

        .filter-popup-close {
            margin-top: 15px;
            padding: 10px;
            background: rgba(192, 57, 43, 0.7);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .filter-popup-close:hover {
            background: rgba(192, 57, 43, 1);
        }

        .filter-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1999;
            display: none;
        }

        .filter-overlay.active {
            display: block;
        }

        .filter-dropdown-btn {
            padding: 10px 15px;
            background: rgba(108, 117, 125, 0.3);
            border: 2px solid rgba(108, 117, 125, 0.5);
            border-radius: 8px;
            color: #ffffff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            white-space: nowrap;
            width: 100%;
        }

        .filter-dropdown-btn.compact-mode {
            padding: 6px 10px;
            font-size: 11px;
        }

        .filter-dropdown-btn:hover {
            background: rgba(108, 117, 125, 0.5);
            transform: scale(1.02);
        }

        .filter-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 0px;
            background: rgba(44, 62, 80, 0.95);
            border: 2px solid rgba(108, 117, 125, 0.5);
            border-radius: 8px;
            padding: 10px 0;
            display: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }

        .filter-dropdown-menu.active {
            display: block;
        }

        .filter-dropdown-item {
            padding: 10px 20px;
            color: #ffffff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-dropdown-item:hover {
            background: rgba(52, 152, 219, 0.3);
        }

        .filter-dropdown-item.active {
            background: rgba(52, 152, 219, 0.5);
            font-weight: 600;
        }

        .filter-dropdown-item .count {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-left: 10px;
        }

        .filter-dropdown-item.active::before {
            content: "✓ ";
            margin-right: 5px;
        }

        .status-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 16px;
            z-index: 9999;
            display: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .status-message.success {
            border: 2px solid #00B050;
        }

        .status-message.error {
            border: 2px solid #FF0000;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .legend-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .legend-circle.green {
            background: #00B050;
        }

        .legend-circle.yellow {
            background: #FFC000;
        }

        .legend-circle.red {
            background: #FF0000;
        }

        .legend-circle.gray {
            background: #808080;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 30px;
            transition: all 0.3s ease;
        }

        .dashboard.compact {
            grid-template-columns: 1fr;
        }

        /* Novo layout para modo Lista de Navios */
        .dashboard.list-mode {
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        .ship-list {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            max-height: 950px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .ship-list.compact {
            display: none;
        }

        .ship-list.list-mode {
            display: block;
            max-height: 750px;
            padding: 15px;
        }

        /* Painel de detalhes do navio */
        .ship-detail-panel {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            color: #333;
            min-height: 750px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .ship-detail-panel.active {
            display: block;
        }

        .ship-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .ship-detail-title {
            background: #fff;
            border: 2px solid #333;
            padding: 15px 30px;
            font-size: 24px;
            font-weight: 700;
            color: #333;
            border-radius: 5px;
        }

        .ship-detail-indicators {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .indicator-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .indicator-circle.green {
            background: linear-gradient(135deg, #00B050 0%, #008040 100%);
            border: 4px solid #006030;
        }

        .indicator-circle.yellow {
            background: linear-gradient(135deg, #FFC000 0%, #E0A000 100%);
            border: 4px solid #C08000;
        }

        .indicator-circle.red {
            background: linear-gradient(135deg, #FF0000 0%, #CC0000 100%);
            border: 4px solid #990000;
        }

        .indicator-circle .indicator-label {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .indicator-circle .indicator-value {
            font-size: 28px;
        }

        .indicator-box {
            background: #fff;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px 25px;
            text-align: center;
        }

        .indicator-box .box-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .indicator-box .box-value {
            font-size: 14px;
            color: #666;
            margin-top: 0px;
        }

        .ship-detail-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        .detail-section {
            background: #f8f8f8;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            min-height: 350px;
        }

        .section-title {
            background: #fff;
            border: 2px solid #333;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            margin: -35px auto 20px auto;
            width: fit-content;
            color: #333;
        }

        .section-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .section-item {
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            color: white;
            cursor: default;
            transition: transform 0.2s ease;
        }

        .section-item:hover {
            transform: scale(1.02);
        }

        .section-item.green {
            background: #00B050;
        }

        .section-item.yellow {
            background: #FFC000;
            color: #333;
        }

        .section-item.red {
            background: #FF0000;
        }

        .section-item.gray {
            background: #808080;
        }

        /* Placeholder quando nenhum navio está selecionado */
        .detail-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 500px;
            color: #999;
            text-align: center;
        }

        .detail-placeholder-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .detail-placeholder-text {
            font-size: 20px;
            font-weight: 500;
        }

        .detail-placeholder-subtext {
            font-size: 14px;
            margin-top: 0px;
            opacity: 0.7;
        }

        .ship-item.selected {
            background: rgba(52, 152, 219, 0.3);
            border-left-color: #3498db;
            border-left-width: 4px;
        }

        .ship-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .ship-item.compact-mode {
            padding: 6px 10px;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .ship-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #95a5a6;
            transform: translateX(5px);
        }

        .ship-item.active {
            background: rgba(149, 165, 166, 0.2);
            border-left-color: #95a5a6;
        }

        .systems-grid {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            max-height: 950px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .systems-grid.compact {
            max-height: none;
            overflow-y: visible;
            padding: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        /* Modo ultra compacto - 3 colunas */
        .systems-grid.compact.ultra-compact {
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .systems-grid.compact.ultra-compact .compact-column-header {
            padding: 6px 8px;
            min-height: 30px;
            display: flex !important;
            align-items: center;
        }

        /* Ocultar header IDADE no modo 3 colunas */
        .systems-grid.compact.ultra-compact .compact-header-idade {
            display: none !important;
        }

        .systems-grid.compact.ultra-compact .ship-row.compact-mode {
            padding: 4px 6px;
            min-height: 40px;
            grid-template-columns: 1fr auto;
        }

        .systems-grid.compact.ultra-compact .ship-name.compact-mode {
            font-size: 11px;
            width: auto;
            min-width: 120px;
        }

        .systems-grid.compact.ultra-compact .ship-class {
            font-size: 7px;
        }

        /* Ocultar idade no modo 3 colunas */
        .systems-grid.compact.ultra-compact .compact-ship-info {
            display: none !important;
        }

        .systems-grid.compact.ultra-compact .status-indicators {
            gap: 10px;
        }

        .systems-grid.compact.ultra-compact .status-indicator {
            width: 16px;
            height: 16px;
        }

        /* Modo privacy - ocultar tripulação e manter layout correto */
        .systems-grid.compact.privacy-compact .crew-section {
            display: none !important;
        }

        .systems-grid.compact.privacy-compact .crew-header-section {
            display: none !important;
        }

        /* ── MODO 2: olho com X (privacy-compact sem ultra-compact) ────────────
           Barra divisória à direita da IDADE no header e nas linhas de dados. */
        .systems-grid.compact.privacy-compact:not(.ultra-compact) .compact-header-section.compact-header-idade {
            border-right: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        .systems-grid.compact.privacy-compact:not(.ultra-compact) .compact-text-section.idade-section {
            border-right: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* Modo 3: sem barra divisória no header */
        .systems-grid.compact.ultra-compact .compact-header-name {
            border-right: none !important;
        }



        .column-container {
            display: contents;
        }

        .systems-grid.compact .column-container {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Remover linhas contínuas - agora todas serão tracejadas */

        /* Wrapper para adicionar linhas tracejadas */
        .systems-grid.compact .ship-row.compact-mode {
            position: relative;
        }

        .systems-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .systems-grid.compact {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .compact-column-header {
            display: none;
        }

        .systems-grid.compact .compact-column-header {
            display: flex;
            align-items: center;
            padding: 8px 8px 8px 10px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            min-height: 40px;
            position: relative;
            position: relative;
        }

        .systems-grid.compact .compact-column-header .classe-filter-badge {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Badge no modo ultra-compact */
        .systems-grid.compact.ultra-compact .compact-column-header .classe-filter-badge {
            position: static;
            transform: none;
            justify-self: end;
            margin-right: 5px;
        }

        .compact-header-name {
            width: 110px;
            min-width: 110px;
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding-right: 10px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Header name no modo ultra-compact */
        .systems-grid.compact.ultra-compact .compact-header-name {
            width: auto;
            min-width: auto;
            justify-content: flex-start;
            padding-left: 5px;
        }

        /* Modo privacidade completa - ocultar colunas de tripulação */
        .privacy-hidden {
            display: none !important;
        }

        .compact-header-section {
            flex: 0 0 auto;
            width: 90px;
            font-size: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
            position: relative;
            cursor: help;
            transition: all 0.3s ease;
        }

        .compact-header-idade {
            width: 55px !important;
        }

        /* Header IDADE no modo ultra-compact */
        .systems-grid.compact.ultra-compact .compact-header-idade {
            width: 45px !important;
            text-align: center;
        }

        .compact-header-section:hover {
            color: #3498db;
            transform: scale(1.05);
        }

        /* Tooltip customizado para headers */
        .compact-header-section[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: tooltipFadeIn 0.3s ease;
            letter-spacing: 0.3px;
            text-transform: none;
        }

        /* Seta do tooltip */
        .compact-header-section[title]:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            border: 6px solid transparent;
            border-top-color: #667eea;
            z-index: 999;
            animation: tooltipFadeIn 0.3s ease;
        }

        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-4px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(-8px);
            }
        }

        .compact-header-indicators {
            flex: 1;
            height: 100%;
        }

        /* Seções de texto para CMT, CFM, IMT */
        .compact-ship-info {
            display: flex;
            align-items: flex-start;
            gap: 0;
        }

        .compact-text-section {
            flex: 0 0 auto;
            width: 90px;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            padding: 0 5px;
            overflow: visible;
            word-wrap: break-word;
            white-space: normal;
            line-height: 1.3;
        }

        /* ===== DIVISÓRIAS DAS COLUNAS (CMT, CFM, IMT) ===== */
        /* Borda direita no nome do navio */
        .ship-row.compact-mode .ship-name.compact-mode {
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            padding-right: 10px;
            margin-right: 5px;
        }

        /* Bordas nas seções de texto (CMT, CFM, IMT) */
        .compact-text-section {
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .compact-text-section:last-child {
            border-right: none;
        }

        /* Estilo para células de tripulação (nome + chave) */
        .crew-section {
            line-height: 1.3;
            padding: 4px 5px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .crew-section br+* {
            font-size: 8px;
            color: rgba(255, 255, 255, 0.5);
        }


        /* Bordas nos headers */
        .compact-header-name {
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Ícone de filtro no header */
        .compact-header-name {
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }

        .compact-header-name:hover {
            color: #3498db;
        }

        .compact-header-name:hover .filter-icon-header {
            opacity: 1 !important;
        }

        .filter-icon-header {
            transition: opacity 0.2s ease;
        }

        /* Estilo quando filtro de classe está ativo */
        .compact-header-name.filter-active {
            color: #3498db;
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }

        .compact-header-name.filter-active .filter-icon-header {
            opacity: 1 !important;
            fill: #3498db;
        }

        /* Badge de classe filtrada no header */
        .classe-filter-badge {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.4);
            display: none;
            white-space: nowrap;
        }

        .classe-filter-badge.active {
            display: inline-block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }


        .compact-header-section {
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .compact-header-section:nth-child(5) {
            border-right: none;
        }

        /* Tooltip para a coluna IDADE */
        .idade-section {
            position: relative;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px 5px;
            width: 55px !important;
            min-height: 40px;
        }

        .idade-section:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.3px;
            pointer-events: none;
        }

        .idade-section:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            border: 6px solid transparent;
            border-top-color: #667eea;
            z-index: 999;
            pointer-events: none;
        }

        .ship-row {
            display: grid;
            grid-template-columns: 1fr;
            align-items: center;
            padding: 15px 20px 15px 25px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ship-row.compact-mode {
            padding: 3px 8px 3px 10px;
            margin-bottom: 2px;
            grid-template-columns: 110px 220px 1fr;
            min-height: 50px;
            align-items: center;
            cursor: default;
        }

        .ship-row:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.01);
        }

        .ship-name {
            font-size: 15px;
            font-weight: 600;
            color: #ffffff;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .ship-name:hover {
            color: #3498db;
            text-decoration: underline;
        }

        .ship-name.compact-mode {
            font-size: 11px;
            gap: 1px;
            line-height: 1.2;
            overflow: visible;
            text-overflow: clip;
            white-space: normal;
            max-width: 110px;
            min-width: 110px;
            word-wrap: break-word;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 50px;
        }

        .ship-class {
            font-size: 10px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
        }

        .ship-name.compact-mode .ship-class {
            font-size: 9px;
            white-space: normal;
            overflow: visible;
            text-overflow: clip;
            max-width: 110px;
            word-wrap: break-word;
        }

        .status-indicators {
            display: flex;
            gap: 25px;
            justify-content: flex-start;
            padding-left: 30px;
            transition: all 0.3s ease;
        }

        .status-indicators.compact-mode {
            gap: 10px;
            padding-left: 0;
            justify-content: flex-end;
            padding-right: 15px;
            position: relative;
        }

        .status-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .status-circle.compact-mode {
            width: 22px;
            height: 22px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .status-circle:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4);
        }

        .status-circle.compact-mode:hover {
            transform: scale(1.15);
        }

        .status-circle.green {
            background: #00B050;
        }

        .status-circle.yellow {
            background: #FFC000;
        }

        .status-circle.red {
            background: #FF0000;
        }

        .status-circle.gray {
            background: #808080;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 1000;
            display: none;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
        }

        .status-circle:hover .tooltip {
            display: block;
        }

        .status-circle.compact-mode .tooltip {
            font-size: 10px;
            padding: 5px 10px;
            bottom: 30px;
            white-space: nowrap;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 15px;
            margin-bottom: 15px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .stat-card {
            text-align: center;
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            min-width: 100px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .stat-card.active-filter {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.15);
        }

        .stat-number {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Scrollbar customizada */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* ========== MODO LISTA DE NAVIOS ========== */
        .lista-navios-container {
            display: none;
            grid-template-columns: 280px 1fr;
            gap: 30px;
            height: calc(100vh - 180px);
            min-height: 800px;
        }

        .lista-navios-container.active {
            display: grid;
        }

        .lista-lateral {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            max-height: 100%;
        }

        .lista-lateral-titulo {
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .navio-item {
            padding: 12px 15px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .navio-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #3498db;
            transform: translateX(5px);
        }

        .navio-item.selected {
            background: rgba(52, 152, 219, 0.3);
            border-left-color: #3498db;
        }

        .navio-item-nome {
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
        }

        .navio-item-classe {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
            margin-top: 3px;
        }

        /* Painel de detalhes */
        .painel-detalhes {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.95) 0%, rgba(52, 73, 94, 0.95) 100%);
            border-radius: 15px;
            padding: 30px;
            overflow-y: auto;
            max-height: 100%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .painel-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
        }

        .painel-placeholder-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .painel-placeholder-texto {
            font-size: 18px;
            font-weight: 300;
        }

        /* Cabeçalho do navio selecionado */
        .detalhes-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
            padding: 20px 0 30px 0;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .navio-titulo-box {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
            padding: 18px 35px;
            border-radius: 5px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-size: 22px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .ido-circle {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2c5f5f 0%, #3d7878 100%);
            border: 5px solid #1a4040;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            color: white;
        }

        .ido-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
        }

        .ido-valor {
            font-size: 24px;
            font-weight: 700;
            color: #3498db;
        }

        .info-cards-header {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
            padding: 15px 25px;
            border-radius: 5px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .info-cards-header p {
            margin: 5px 0;
            font-size: 14px;
        }

        .info-cards-header strong {
            font-weight: 700;
        }

        /* Seções de categorias */
        .categorias-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 0px;
        }

        .categoria-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 25px 20px 20px 20px;
            min-height: 550px;
            transition: all 0.3s ease;
        }

        .categoria-box.categoria-destacada {
            border: 3px solid #3498db;
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
            background: rgba(52, 152, 219, 0.15);
            transform: scale(1.02);
        }

        .categoria-titulo {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
            padding: 10px 20px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            margin-top: -35px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .categoria-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .categoria-item {
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #ffffff;
            text-align: center;
            transition: all 0.3s ease;
            cursor: default;
        }

        .categoria-item.verde {
            background: #27ae60;
        }

        .categoria-item.amarelo {
            background: #f1c40f;
            color: #1a1a2e;
        }

        .categoria-item.vermelho {
            background: #e74c3c;
        }

        .categoria-item.cinza {
            background: #7f8c8d;
        }

        .categoria-item:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .categoria-item-wrapper {
            position: relative;
            display: block;
            width: 100%;
        }

        .categoria-item.tem-obs {
            cursor: pointer;
            padding-right: 30px;
        }

        .categoria-item.tem-obs::after {
            content: "ℹ️";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 11px;
            opacity: 0.8;
        }

        .tooltip-obs {
            position: absolute;
            left: calc(100% + 15px);
            top: 50%;
            transform: translateY(-50%);
            min-width: 280px;
            max-width: 320px;
            padding: 14px 16px;
            border-radius: 10px;
            font-size: 12px;
            color: #ffffff;
            line-height: 1.5;
            z-index: 2000;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.25s ease, visibility 0.25s ease;
            pointer-events: none;
        }

        .tooltip-obs.visible {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .tooltip-obs.obs-amarelo {
            background: linear-gradient(135deg, #a67c00 0%, #7a5c00 100%);
            border: 2px solid #FFC000;
        }

        .tooltip-obs.obs-vermelho {
            background: linear-gradient(135deg, #b02a2a 0%, #8a1f1f 100%);
            border: 2px solid #FF4444;
        }

        .tooltip-obs-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tooltip-obs-texto {
            font-size: 13px;
            line-height: 1.6;
        }

        .tooltip-obs::before {
            content: "";
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 10px solid transparent;
        }

        .tooltip-obs.obs-amarelo::before {
            border-right-color: #a67c00;
        }

        .tooltip-obs.obs-vermelho::before {
            border-right-color: #b02a2a;
        }

        .tooltip-obs.tooltip-esquerda {
            left: auto;
            right: calc(100% + 15px);
        }

        .tooltip-obs.tooltip-esquerda::before {
            right: auto;
            left: 100%;
            border-right-color: transparent !important;
        }

        .tooltip-obs.tooltip-esquerda.obs-amarelo::before {
            border-left-color: #a67c00;
        }

        .tooltip-obs.tooltip-esquerda.obs-vermelho::before {
            border-left-color: #b02a2a;
        }

        @media (max-width: 1400px) {
            .categorias-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1000px) {
            .categorias-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-logo" onclick="voltarParaHome()" style="cursor: pointer;" title="Voltar para Home">
                <img src="https://transpetro.sharepoint.com/sites/EstadoGeralDosNavios2/DashboardApp/logo-transpetro.png"
                    alt="Transpetro">
            </div>
            <div class="header-text">
                <h1>Estado Geral dos Navios</h1>
                <div class="subtitle">Sistema de Monitoramento - 26 Embarcações</div>
            </div>
            <div class="home-button-container">
                <button class="btn-home" id="btnHome" onclick="voltarParaHome()">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                    </svg>
                    <span class="tooltip-home">Home</span>
                </button>
                <button class="btn-home btn-privacy" id="btnPrivacy" onclick="togglePrivacyMode()">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                    </svg>
                    <span class="tooltip-home">Ocultar nomes</span>
                </button>
            </div>
        </div>

        <div id="statusMessage" class="status-message"></div>

        <!-- Overlay e Popup de filtro (acionado pelos headers) -->
        <div class="filter-overlay" id="filterOverlay" onclick="closeFilterPopup()"></div>
        <div class="filter-popup" id="filterPopup">
            <div class="filter-popup-header">Filtrar por Classe</div>
            <div class="filter-chips-container" id="filterChipsContainer"></div>
            <div class="filter-actions">
                <button class="filter-btn-clear" onclick="limparFiltrosClasse()">Limpar</button>
                <button class="filter-btn-apply" onclick="aplicarFiltrosClasse()">Aplicar Filtros</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card" id="filterGreen" onclick="filterByColor('green')"
                title="Filtrar embarcações com pelo menos 1 categoria OK">
                <div class="stat-number" style="color: #00B050;" id="greenCount">0</div>
                <div class="stat-label">Operacional</div>
            </div>
            <div class="stat-card" id="filterYellow" onclick="filterByColor('yellow')"
                title="Filtrar embarcações com pelo menos 1 categoria em atenção">
                <div class="stat-number" style="color: #FFC000;" id="yellowCount">0</div>
                <div class="stat-label">Atenção</div>
            </div>
            <div class="stat-card" id="filterRed" onclick="filterByColor('red')"
                title="Filtrar embarcações com pelo menos 1 categoria crítica">
                <div class="stat-number" style="color: #FF0000;" id="redCount">0</div>
                <div class="stat-label">Críticos</div>
            </div>
            <div class="stat-card" id="filterGray" onclick="filterByColor('gray')"
                title="Filtrar embarcações com dados pendentes">
                <div class="stat-number" style="color: #808080;" id="grayCount">0</div>
                <div class="stat-label">Dados Pendentes</div>
            </div>
        </div>

        <div class="dashboard">
            <div class="ship-list" id="shipList">
                <div class="filter-dropdown-container">
                    <button class="filter-dropdown-btn" onclick="toggleFilterDropdown()">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="white"
                            style="vertical-align: middle; margin-right: 5px;">
                            <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z" />
                        </svg>
                        Filtrar: <span id="filterLabel">Todas</span>
                    </button>
                    <div class="filter-dropdown-menu" id="filterDropdown">
                        <div id="filterDropdownItems"></div>
                    </div>
                </div>
            </div>
            <div class="systems-grid" id="systemsGrid"></div>
        </div>

        <!-- Container para modo Lista de Navios -->
        <div class="lista-navios-container" id="listaNaviosContainer">
            <div class="lista-lateral">
                <div class="lista-lateral-titulo">🚢 Embarcações</div>
                <div id="listaNaviosItems"></div>
            </div>
            <div class="painel-detalhes" id="painelDetalhes">
                <div class="painel-placeholder">
                    <div class="painel-placeholder-icon">🚢</div>
                    <div class="painel-placeholder-texto">Selecione um navio na lista<br>para ver os detalhes</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let navioSelecionado = null;

        const sistemas = [
            'Equipamentos',
            'Pessoal',
            'Certificação'
        ];

        const shipBirthDates = {
            "CELSO FURTADO": "07/11/2011",
            "JOAO CANDIDO": "14/05/2012",
            "SERGIO BUARQUE DE HOLANDA": "18/06/2012",
            "ANGRA DOS REIS": "01/07/2012",
            "MADRE DE DEUS": "01/08/2012",
            "RIO GRANDE": "25/09/2012",
            "SAO SEBASTIAO": "25/09/2012",
            "ROMULO ALMEIDA": "17/12/2012",
            "SAO LUIZ": "01/01/2013",
            "ZUMBI DOS PALMARES": "22/04/2013",
            "JOSE ALENCAR": "10/10/2013",
            "DRAGAO DO MAR": "16/12/2013",
            "HENRIQUE DIAS": "19/11/2014",
            "ANITA GARIBALDI": "30/12/2014",
            "ANDRE REBOUCAS": "08/04/2015",
            "OSCAR NIEMEYER": "09/07/2015",
            "MARCILIO DIAS": "02/09/2015",
            "JOSE DO PATROCINIO": "08/12/2015",
            "BARBOSA LIMA SOBRINHO": "08/01/2016",
            "DARCY RIBEIRO": "20/06/2016",
            "LUCIO COSTA": "20/09/2016",
            "MACHADO DE ASSIS": "21/09/2016",
            "MILTON SANTOS": "10/05/2017",
            "ABDIAS NASCIMENTO": "04/09/2017",
            "GILBERTO FREYRE": "18/10/2017",
            "CASTRO ALVES": "11/05/2018",
            "CARLOS DRUMMOND DE ANDRADE": "12/09/2018",
            "JORGE AMADO": "30/10/2018",
            "OLAVO BILAC": "28/11/2018",
            "GARRINCHA": "19/03/2019",
            "PORTINARI": "24/06/2019"
        };

        // Dados de IDO-SD, Reqs Outstanding e SRs Outstanding por navio
        const dadosIndicadores = {
            // PANAMAX
            "ANITA GARIBALDI": { idoSD: 96, reqsOutstanding: 31, srsOutstanding: 27 },
            // AFRAMAX
            "CASTRO ALVES": { idoSD: 92, reqsOutstanding: 18, srsOutstanding: 42 },
            "CARLOS DRUMMOND DE ANDRADE": { idoSD: 78, reqsOutstanding: 45, srsOutstanding: 68 },
            "OLAVO BILAC": { idoSD: 94, reqsOutstanding: 22, srsOutstanding: 35 },
            "GARRINCHA": { idoSD: 88, reqsOutstanding: 28, srsOutstanding: 51 },
            "PORTINARI": { idoSD: 91, reqsOutstanding: 19, srsOutstanding: 33 },
            // SUEZMAX
            "JOAO CANDIDO": { idoSD: 85, reqsOutstanding: 38, srsOutstanding: 55 },
            "DRAGAO DO MAR": { idoSD: 89, reqsOutstanding: 25, srsOutstanding: 49 },
            "HENRIQUE DIAS": { idoSD: 93, reqsOutstanding: 21, srsOutstanding: 38 },
            "ANDRE REBOUCAS": { idoSD: 97, reqsOutstanding: 12, srsOutstanding: 24 },
            "MARCILIO DIAS": { idoSD: 90, reqsOutstanding: 29, srsOutstanding: 44 },
            "JOSE DO PATROCINIO": { idoSD: 82, reqsOutstanding: 41, srsOutstanding: 62 },
            "MACHADO DE ASSIS": { idoSD: 95, reqsOutstanding: 16, srsOutstanding: 31 },
            "MILTON SANTOS": { idoSD: 87, reqsOutstanding: 33, srsOutstanding: 52 },
            "ABDIAS NASCIMENTO": { idoSD: 84, reqsOutstanding: 36, srsOutstanding: 58 },
            "ZUMBI DOS PALMARES": { idoSD: 91, reqsOutstanding: 24, srsOutstanding: 41 },
            // PRODUTOS
            "CELSO FURTADO": { idoSD: 93, reqsOutstanding: 20, srsOutstanding: 36 },
            "SERGIO BUARQUE DE HOLANDA": { idoSD: 89, reqsOutstanding: 27, srsOutstanding: 45 },
            "ROMULO ALMEIDA": { idoSD: 81, reqsOutstanding: 39, srsOutstanding: 59 },
            "JOSE ALENCAR": { idoSD: 86, reqsOutstanding: 32, srsOutstanding: 48 },
            // GASEIRO 7K
            "LUCIO COSTA": { idoSD: 94, reqsOutstanding: 17, srsOutstanding: 29 },
            "DARCY RIBEIRO": { idoSD: 88, reqsOutstanding: 26, srsOutstanding: 43 },
            "BARBOSA LIMA SOBRINHO": { idoSD: 92, reqsOutstanding: 23, srsOutstanding: 37 },
            "OSCAR NIEMEYER": { idoSD: 85, reqsOutstanding: 35, srsOutstanding: 54 },
            // GASEIRO 4K
            "GILBERTO FREYRE": { idoSD: 90, reqsOutstanding: 28, srsOutstanding: 46 },
            "JORGE AMADO": { idoSD: 87, reqsOutstanding: 31, srsOutstanding: 50 }
        };

        const tripulacaoNavios = {
            // PANAMAX
            "ANITA GARIBALDI": {
                CMT: "Wilson Luiz Silva de Oliveira", CMT_MAT: "2224",
                CFM: "Rudiley Belfort Santos", CFM_MAT: "158",
                IMT: "Williams Naimaier Pontes", IMT_MAT: "3119"
            },
            // AFRAMAX
            "CASTRO ALVES": {
                CMT: "Eudvan de Melo Lucena", CMT_MAT: "187",
                CFM: "Raimundo Nonato Lima Vieira", CFM_MAT: "3626",
                IMT: "Alexandre Pinheiro Baptista", IMT_MAT: "7898"
            },
            "CARLOS DRUMMOND DE ANDRADE": {
                CMT: "Alex Alves Pequeno", CMT_MAT: "1076",
                CFM: "Rogaciano Raimundo Gregorio de Andrade", CFM_MAT: "780",
                IMT: "Ana Paula Leite Noronha", IMT_MAT: "6539"
            },
            "OLAVO BILAC": {
                CMT: "Pedro Fabiano Alves de Moura", CMT_MAT: "2500",
                CFM: "Jader de Oliveira Guedes Araujo", CFM_MAT: "546",
                IMT: "Não informado", IMT_MAT: ""
            },
            "GARRINCHA": {
                CMT: "Aroldo Caleber Rodrigues Ferreira", CMT_MAT: "1991",
                CFM: "Jonathan Carvalho Goncalves", CFM_MAT: "7281",
                IMT: "Jose Lucena da Rocha Neto", IMT_MAT: "4518"
            },
            "PORTINARI": {
                CMT: "Josevaldo Uchoa Correa", CMT_MAT: "2919",
                CFM: "Joao Luiz Oliveira de Souza", CFM_MAT: "419",
                IMT: "Paulo Renato de Almeida Barbosa", IMT_MAT: "7670"
            },
            // SUEZMAX
            "JOAO CANDIDO": {
                CMT: "Não informado", CMT_MAT: "",
                CFM: "Diego Saraiva Monteiro", CFM_MAT: "4345",
                IMT: "Andrew Rafael dos Reis Gomes", IMT_MAT: "7652"
            },
            "DRAGAO DO MAR": {
                CMT: "Welber Luiz Fernandes Martins", CMT_MAT: "4171",
                CFM: "Francisco Cesar Mena", CFM_MAT: "6527",
                IMT: "Valmir Aparecido da Cunha", IMT_MAT: "2328"
            },
            "HENRIQUE DIAS": {
                CMT: "Joao Americo da Costa Gaspar Neto", CMT_MAT: "2155",
                CFM: "Julio Ricardo Escurra Robles", CFM_MAT: "114303",
                IMT: "Flavia Cursino da Silva", IMT_MAT: "5154"
            },
            "ANDRE REBOUCAS": {
                CMT: "Luciano Santos Rodrigues", CMT_MAT: "5521",
                CFM: "Veberson Cassio Lima dos Santos", CFM_MAT: "1047",
                IMT: "Pedro Fernandes Ferreira da Silva", IMT_MAT: "6464"
            },
            "MARCILIO DIAS": {
                CMT: "Renato Ramos Diniz", CMT_MAT: "540",
                CFM: "Francisco Jose Cunha Martins", CFM_MAT: "878",
                IMT: "Ariana Kelly Mota Gemaque", IMT_MAT: "7674"
            },
            "JOSE DO PATROCINIO": {
                CMT: "Albano Silva Fidalgo", CMT_MAT: "1002",
                CFM: "Severino Arruda Cabral Neto", CFM_MAT: "2989",
                IMT: "Igor Penedo de Matos", IMT_MAT: "6531"
            },
            "MACHADO DE ASSIS": {
                CMT: "Luciano Pimentel Jorge de Souza", CMT_MAT: "865",
                CFM: "Vicente de Paula Lopes Junior", CFM_MAT: "2264",
                IMT: "Jose Cleber Freitas Santos", IMT_MAT: "5475"
            },
            "MILTON SANTOS": {
                CMT: "Carlos Alberto Pereira da Silva", CMT_MAT: "148",
                CFM: "Alex Jean Xavier da Conceicao", CFM_MAT: "2054",
                IMT: "Mario Jorge Alves da Silva", IMT_MAT: "1930"
            },
            "ABDIAS NASCIMENTO": {
                CMT: "Antonio Mario Conor de Oliveira", CMT_MAT: "861",
                CFM: "Ubirajara do Rosario Santana", CFM_MAT: "1048",
                IMT: "Não informado", IMT_MAT: ""
            },
            "ZUMBI DOS PALMARES": {
                CMT: "Joao Ricardo Rodrigues de Sousa", CMT_MAT: "3207",
                CFM: "Antonio Francisco de Araujo Dias", CFM_MAT: "78",
                IMT: "Manoel Sebastiao Modesto do Nascimento", IMT_MAT: "7458"
            },
            // PRODUTOS
            "CELSO FURTADO": {
                CMT: "Wellington Ferreira Fontes", CMT_MAT: "168",
                CFM: "Sixto Gonzalez Ortigoza", CFM_MAT: "7763",
                IMT: "Bento Vivaldo da Silva Junior", IMT_MAT: "8072"
            },
            "SERGIO BUARQUE DE HOLANDA": {
                CMT: "Raimundo Nonato Guedes Leal", CMT_MAT: "734",
                CFM: "Benedito Paulo Viana Martins Ferreira", CFM_MAT: "594",
                IMT: "Diego Alysson Nunes Maia", IMT_MAT: "7960"
            },
            "ROMULO ALMEIDA": {
                CMT: "Marco Antonio Silva Carvalho", CMT_MAT: "1008",
                CFM: "Raimundo Gomes Pereira", CFM_MAT: "496",
                IMT: "Renatha Viana Limeira", IMT_MAT: "7958"
            },
            "JOSE ALENCAR": {
                CMT: "Luis Otavio de Miranda", CMT_MAT: "841",
                CFM: "Gladiel Henrique Lopes Marques", CFM_MAT: "4609",
                IMT: "Fernanda Liebl", IMT_MAT: "7688"
            },
            // GASEIRO 7K
            "LUCIO COSTA": {
                CMT: "Armando Leite Ribeiro", CMT_MAT: "7660",
                CFM: "Marilia de Andrade Mazzer", CFM_MAT: "7326",
                IMT: "Lorena Silva Cuimar", IMT_MAT: "8671"
            },
            "DARCY RIBEIRO": {
                CMT: "Ayrton Martins Caldeira Filho", CMT_MAT: "468",
                CFM: "Rafael Farinasso Lourenco", CFM_MAT: "7246",
                IMT: "Auricelio Amarante de Andrade", IMT_MAT: "7655"
            },
            "BARBOSA LIMA SOBRINHO": {
                CMT: "Rufino Ignacio Vera", CMT_MAT: "35",
                CFM: "Tomas Correia Braga", CFM_MAT: "7653",
                IMT: "Gilson de Vasconcelos Torres Junior", IMT_MAT: "7919"
            },
            "OSCAR NIEMEYER": {
                CMT: "Breno Fonseca Lelis", CMT_MAT: "3051",
                CFM: "Paulo Sergio Alves da Silva", CFM_MAT: "1685",
                IMT: "Thiago Ramiro Moreira de Sousa", IMT_MAT: "8041"
            },
            // GASEIRO 4K
            "GILBERTO FREYRE": {
                CMT: "Wannessa de Nazare Barbosa de Aguiar", CMT_MAT: "7602",
                CFM: "Marcilio Azevedo do Nascimento", CFM_MAT: "7273",
                IMT: "Hamilton Manoel Nepomuceno Junior", IMT_MAT: "7671"
            },
            "JORGE AMADO": {
                CMT: "Marcos Vinicius do Nascimento", CMT_MAT: "6528",
                CFM: "Reinaldo Jose Ferreira dos Santos", CFM_MAT: "134",
                IMT: "Rafael Romulo de Oliveira Martins", IMT_MAT: "7633"
            }
        };

        const statusDetalhesNavios = {
            "ANITA GARIBALDI": {
                equipamentos: {
                    "Motor principal": { cor: "verde", obs: "" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "amarelo", obs: "Produção reduzida" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "vermelho", obs: "Vazamento na válvula" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "amarelo", obs: "Centrifugação irregular" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "amarelo", obs: "Trifix em 72%" },
                    "Tripulantes vencidos": { cor: "vermelho", obs: "12 certificados vencendo" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "verde", obs: "" },
                    "Condição de classe": { cor: "vermelho", obs: "3 condições pendentes" },
                    "Obs Vetting": { cor: "verde", obs: "" }
                }
            },
            "CASTRO ALVES": {
                equipamentos: {
                    "Motor principal": { cor: "verde", obs: "" },
                    "MCAs": { cor: "amarelo", obs: "Vibração acima do normal" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "amarelo", obs: "Corrosão no manifold" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "verde", obs: "" },
                    "Tripulantes vencidos": { cor: "verde", obs: "" },
                    "Crew Matrix": { cor: "vermelho", obs: "Falta 1 Oficial" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "verde", obs: "" },
                    "Condição de classe": { cor: "verde", obs: "" },
                    "Obs Vetting": { cor: "amarelo", obs: "8 observações" }
                }
            },
            "CARLOS DRUMMOND DE ANDRADE": {
                equipamentos: {
                    "Motor principal": { cor: "vermelho", obs: "Cilindro 3 baixa compressão" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "amarelo", obs: "Certificado vencendo" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "amarelo", obs: "Falha no ECDIS" },
                    "Estado geral PM": { cor: "amarelo", obs: "Limpeza pendente" }
                },
                pessoal: {
                    "Trifix %": { cor: "verde", obs: "" },
                    "Tripulantes vencidos": { cor: "amarelo", obs: "5 certificados vencendo" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "amarelo", obs: "ISPS pendente" },
                    "Condição de classe": { cor: "verde", obs: "" },
                    "Obs Vetting": { cor: "verde", obs: "" }
                }
            },
            "OLAVO BILAC": {
                equipamentos: {
                    "Motor principal": { cor: "verde", obs: "" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "amarelo", obs: "Eficiência reduzida" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "amarelo", obs: "Filtros próximos da troca" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "verde", obs: "" },
                    "Tripulantes vencidos": { cor: "verde", obs: "" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "amarelo", obs: "2 cursos vencendo" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "verde", obs: "" },
                    "Condição de classe": { cor: "amarelo", obs: "Prazo em 30 dias" },
                    "Obs Vetting": { cor: "verde", obs: "" }
                }
            },
            "GARRINCHA": {
                equipamentos: {
                    "Motor principal": { cor: "verde", obs: "" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "amarelo", obs: "Teste pendente" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "verde", obs: "" },
                    "Tripulantes vencidos": { cor: "amarelo", obs: "4 certificados vencendo" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "cinza", obs: "" },
                    "Condição de classe": { cor: "vermelho", obs: "3 condições vencidas" },
                    "Obs Vetting": { cor: "amarelo", obs: "9 observações" }
                }
            },
            "PORTINARI": {
                equipamentos: {
                    "Motor principal": { cor: "cinza", obs: "" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "vermelho", obs: "Inoperante" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "amarelo", obs: "Repintura necessária" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "vermelho", obs: "Trifix em 45%" },
                    "Tripulantes vencidos": { cor: "verde", obs: "" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "amarelo", obs: "Certificado pendente" },
                    "Condição de classe": { cor: "verde", obs: "" },
                    "Obs Vetting": { cor: "verde", obs: "" }
                }
            },
            "MACHADO DE ASSIS": {
                equipamentos: {
                    "Motor principal": { cor: "verde", obs: "" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "amarelo", obs: "Ajuste necessário" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "verde", obs: "" },
                    "Tripulantes vencidos": { cor: "verde", obs: "" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "verde", obs: "" },
                    "Condição de classe": { cor: "verde", obs: "" },
                    "Obs Vetting": { cor: "verde", obs: "" }
                }
            },
            "OSCAR NIEMEYER": {
                equipamentos: {
                    "Motor principal": { cor: "amarelo", obs: "Temperatura alta" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "amarelo", obs: "Folga no sistema" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "verde", obs: "" },
                    "Tripulantes vencidos": { cor: "amarelo", obs: "6 documentos vencendo" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "verde", obs: "" },
                    "Condição de classe": { cor: "amarelo", obs: "2 condições" },
                    "Obs Vetting": { cor: "vermelho", obs: "15 observações" }
                }
            },
            "DRAGAO DO MAR": {
                equipamentos: {
                    "Motor principal": { cor: "verde", obs: "" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "verde", obs: "" },
                    "Tripulantes vencidos": { cor: "verde", obs: "" },
                    "Crew Matrix": { cor: "verde", obs: "" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "cinza", obs: "" },
                    "Condição de classe": { cor: "vermelho", obs: "2 condições vencidas" },
                    "Obs Vetting": { cor: "amarelo", obs: "5 observações" }
                }
            },
            "DARCY RIBEIRO": {
                equipamentos: {
                    "Motor principal": { cor: "verde", obs: "" },
                    "MCAs": { cor: "verde", obs: "" },
                    "Grupo destilatório": { cor: "verde", obs: "" },
                    "Equip. fundeio, amarração e guindastes": { cor: "verde", obs: "" },
                    "Caldeira auxiliar": { cor: "verde", obs: "" },
                    "Estado geral convés": { cor: "verde", obs: "" },
                    "DGE E BBA incêndio emergência": { cor: "verde", obs: "" },
                    "Sistema de carga e descarga": { cor: "verde", obs: "" },
                    "Máquina do leme": { cor: "verde", obs: "" },
                    "Purificadores": { cor: "verde", obs: "" },
                    "Sistemas de navegação": { cor: "verde", obs: "" },
                    "Estado geral PM": { cor: "verde", obs: "" }
                },
                pessoal: {
                    "Trifix %": { cor: "cinza", obs: "" },
                    "Tripulantes vencidos": { cor: "vermelho", obs: "8 vencidos" },
                    "Crew Matrix": { cor: "amarelo", obs: "Falta 1" },
                    "Certificação de Tripulante": { cor: "verde", obs: "" }
                },
                certificacao: {
                    "Pendência de Documentação Navio": { cor: "verde", obs: "" },
                    "Condição de classe": { cor: "verde", obs: "" },
                    "Obs Vetting": { cor: "verde", obs: "" }
                }
            }
        };

        function gerarStatusAleatorio() {
            const cores = ["verde", "verde", "verde", "verde", "verde", "amarelo", "amarelo", "vermelho"];

            const obsEquipamentos = {
                amarelo: [
                    "Manutenção programada",
                    "Em monitoramento",
                    "Inspeção agendada",
                    "Desgaste no limite",
                    "Ajuste necessário"
                ],
                vermelho: [
                    "Inoperante",
                    "Reparo urgente",
                    "Fora dos parâmetros",
                    "Em manutenção",
                    "Substituição pendente"
                ]
            };

            const obsPessoal = {
                amarelo: [
                    "Trifix entre 50% e 79%",
                    "4-10 vencendo",
                    "Vencendo",
                    "Treinamentos pendentes"
                ],
                vermelho: [
                    "Trifix abaixo de 50% - crítico",
                    ">10 vencidos",
                    "Crew incompleto",
                    "Vencidas"
                ]
            };

            const obsCertificacao = {
                amarelo: [
                    "Renovação pendente",
                    "7-12 observações",
                    "Prazo próximo",
                    "Aguardando emissão"
                ],
                vermelho: [
                    "Vencida",
                    ">12 observações",
                    "Prazo vencido",
                    "Pendência crítica"
                ]
            };

            return function (item, categoria) {
                const cor = cores[Math.floor(Math.random() * cores.length)];
                let obs = "";

                if (cor !== "verde") {
                    let obsLista;
                    if (categoria === "equipamentos") {
                        obsLista = obsEquipamentos[cor];
                    } else if (categoria === "pessoal") {
                        obsLista = obsPessoal[cor];
                    } else {
                        obsLista = obsCertificacao[cor];
                    }
                    obs = obsLista[Math.floor(Math.random() * obsLista.length)];
                }

                return { cor, obs };
            };
        }

        // Cache para armazenar status gerados aleatoriamente (persiste até F5)
        const statusCache = {};

        function getStatusNavio(nomeNavio) {
            // Se tem dados específicos, usa eles
            if (statusDetalhesNavios[nomeNavio]) {
                return statusDetalhesNavios[nomeNavio];
            }

            // Se já gerou aleatório para este navio, retorna do cache
            if (statusCache[nomeNavio]) {
                return statusCache[nomeNavio];
            }

            // Gera aleatório e salva no cache
            const gerador = gerarStatusAleatorio();
            const equipamentosItems = [
                "Motor principal", "MCAs", "Grupo destilatório",
                "Equip. fundeio, amarração e guindastes", "Caldeira auxiliar",
                "DGE E BBA incêndio emergência", "Sistema de carga e descarga",
                "Máquina do leme", "Purificadores", "Sistemas de navegação",
                "Estado geral convés", "Estado geral PM"
            ];
            const pessoalItems = ["Trifix %", "Tripulantes vencidos", "Crew Matrix", "Certificação de Tripulante"];
            const certificacaoItems = ["Pendência de Documentação Navio", "Condição de classe", "Obs Vetting"];

            const status = { equipamentos: {}, pessoal: {}, certificacao: {} };

            equipamentosItems.forEach(item => { status.equipamentos[item] = gerador(item, "equipamentos"); });
            pessoalItems.forEach(item => { status.pessoal[item] = gerador(item, "pessoal"); });
            certificacaoItems.forEach(item => { status.certificacao[item] = gerador(item, "certificacao"); });

            // Salva no cache
            statusCache[nomeNavio] = status;

            return status;
        }

        // Calcula status resumido por categoria (Equipamentos, Pessoal, Certificação)
        function calcularStatusResumo(nomeNavio) {
            // Se temos dados do SharePoint para este navio, usar
            if (dadosSharePoint && dadosSharePoint[nomeNavio]) {
                return processarDadosNavioSharePoint(dadosSharePoint[nomeNavio]);
            }

            // Usar os mesmos dados detalhados que aparecem no perfil do navio
            const statusDetalhado = getStatusNavio(nomeNavio);

            if (statusDetalhado) {
                // Função para calcular pior cor de uma categoria
                const calcularPiorCategoria = (categoria) => {
                    if (!categoria || Object.keys(categoria).length === 0) {
                        return 'gray';
                    }

                    let temVermelho = false;
                    let temAmarelo = false;
                    let temCinza = false;

                    Object.values(categoria).forEach(item => {
                        const cor = item.cor || item;
                        if (cor === 'vermelho' || cor === 'red') temVermelho = true;
                        else if (cor === 'amarelo' || cor === 'yellow') temAmarelo = true;
                        else if (cor === 'cinza' || cor === 'gray') temCinza = true;
                    });

                    // Prioridade: cinza > vermelho > amarelo > verde
                    if (temCinza) return 'gray';
                    if (temVermelho) return 'red';
                    if (temAmarelo) return 'yellow';
                    return 'green';
                };

                const corEquipamentos = calcularPiorCategoria(statusDetalhado.equipamentos);
                const corPessoal = calcularPiorCategoria(statusDetalhado.pessoal);
                const corCertificacao = calcularPiorCategoria(statusDetalhado.certificacao);

                return [corEquipamentos, corPessoal, corCertificacao];
            }

            // Fallback: retorna cinza se não tiver dados
            return ['gray', 'gray', 'gray'];
        }

        function gerarItemCategoria(nome, status) {
            const { cor, obs } = status;
            const temObs = (cor === "amarelo" || cor === "vermelho") && obs;
            const obsClass = temObs ? "tem-obs" : "";

            let html = `<div class="categoria-item-wrapper">`;
            html += `<div class="categoria-item ${cor} ${obsClass}" 
                         data-obs="${temObs ? obs.replace(/"/g, '&quot;') : ''}"
                         data-cor="${cor}">
                         ${nome}
                     </div>`;

            if (temObs) {
                const tipoObs = cor === "amarelo" ? "obs-amarelo" : "obs-vermelho";
                const icone = cor === "amarelo" ? "📝" : "⚠️";
                const titulo = cor === "amarelo" ? "Observação" : "Atenção";
                html += `<div class="tooltip-obs ${tipoObs}">
                    <div class="tooltip-obs-header">${icone} ${titulo}</div>
                    <div class="tooltip-obs-texto">${obs}</div>
                </div>`;
            }

            html += `</div>`;
            return html;
        }

        let tooltipFixoAtual = null;

        function configurarTooltips() {
            document.querySelectorAll('.categoria-item.tem-obs').forEach(item => {
                const wrapper = item.parentElement;
                const tooltip = wrapper.querySelector('.tooltip-obs');

                if (!tooltip) return;

                function ajustarPosicaoTooltip() {
                    tooltip.classList.remove('tooltip-esquerda');

                    tooltip.style.visibility = 'hidden';
                    tooltip.style.opacity = '0';
                    tooltip.style.display = 'block';

                    const tooltipRect = tooltip.getBoundingClientRect();
                    const windowWidth = window.innerWidth;

                    if (tooltipRect.right > windowWidth - 20) {
                        tooltip.classList.add('tooltip-esquerda');
                    }

                    tooltip.style.visibility = '';
                    tooltip.style.opacity = '';
                    tooltip.style.display = '';
                }

                item.addEventListener('mouseenter', function () {
                    if (!tooltip.classList.contains('fixo')) {
                        ajustarPosicaoTooltip();
                        tooltip.classList.add('visible');
                    }
                });

                item.addEventListener('mouseleave', function () {
                    if (!tooltip.classList.contains('fixo')) {
                        tooltip.classList.remove('visible');
                    }
                });

                item.addEventListener('click', function (e) {
                    e.stopPropagation();

                    if (tooltipFixoAtual && tooltipFixoAtual !== tooltip) {
                        tooltipFixoAtual.classList.remove('fixo');
                        tooltipFixoAtual.classList.remove('visible');
                    }

                    if (tooltip.classList.contains('fixo')) {
                        tooltip.classList.remove('fixo');
                        tooltip.classList.remove('visible');
                        tooltipFixoAtual = null;
                    } else {
                        ajustarPosicaoTooltip();
                        tooltip.classList.add('fixo');
                        tooltip.classList.add('visible');
                        tooltipFixoAtual = tooltip;
                    }
                });
            });
        }

        document.addEventListener('click', function (e) {
            if (tooltipFixoAtual && !e.target.closest('.categoria-item-wrapper')) {
                tooltipFixoAtual.classList.remove('fixo');
                tooltipFixoAtual.classList.remove('visible');
                tooltipFixoAtual = null;
            }
        });

        function calculateShipAge(shipName) {
            const birthDateStr = shipBirthDates[shipName.toUpperCase()];
            if (!birthDateStr) return { years: '-', days: '-' };

            const parts = birthDateStr.split('/');
            const birthDate = new Date(parts[2], parts[1] - 1, parts[0]);
            const today = new Date();

            const diffTime = today - birthDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const diffYears = Math.floor(diffDays / 365.25);

            return { years: diffYears, days: diffDays };
        }

        // Variável global para armazenar dados do SharePoint
        let dadosSharePoint = {};

        const naviosReais = [
            // PANAMAX (1)
            { nome: "ANITA GARIBALDI", classe: "Panamax" },

            // AFRAMAX (5)
            { nome: "CASTRO ALVES", classe: "Aframax" },
            { nome: "CARLOS DRUMMOND DE ANDRADE", classe: "Aframax" },
            { nome: "OLAVO BILAC", classe: "Aframax" },
            { nome: "GARRINCHA", classe: "Aframax" },
            { nome: "PORTINARI", classe: "Aframax" },

            // SUEZMAX (10)
            { nome: "JOAO CANDIDO", classe: "Suezmax" },
            { nome: "DRAGAO DO MAR", classe: "Suezmax" },
            { nome: "HENRIQUE DIAS", classe: "Suezmax" },
            { nome: "ANDRE REBOUCAS", classe: "Suezmax" },
            { nome: "MARCILIO DIAS", classe: "Suezmax" },
            { nome: "JOSE DO PATROCINIO", classe: "Suezmax" },
            { nome: "MACHADO DE ASSIS", classe: "Suezmax" },
            { nome: "MILTON SANTOS", classe: "Suezmax" },
            { nome: "ABDIAS NASCIMENTO", classe: "Suezmax" },
            { nome: "ZUMBI DOS PALMARES", classe: "Suezmax" },

            // PRODUTOS (4)
            { nome: "CELSO FURTADO", classe: "Produtos" },
            { nome: "SERGIO BUARQUE DE HOLANDA", classe: "Produtos" },
            { nome: "ROMULO ALMEIDA", classe: "Produtos" },
            { nome: "JOSE ALENCAR", classe: "Produtos" },

            // GASEIRO 7K (4)
            { nome: "LUCIO COSTA", classe: "Gaseiro 7k" },
            { nome: "DARCY RIBEIRO", classe: "Gaseiro 7k" },
            { nome: "BARBOSA LIMA SOBRINHO", classe: "Gaseiro 7k" },
            { nome: "OSCAR NIEMEYER", classe: "Gaseiro 7k" },

            // GASEIRO 4K (2)
            { nome: "GILBERTO FREYRE", classe: "Gaseiro 4k" },
            { nome: "JORGE AMADO", classe: "Gaseiro 4k" }
        ];

        // Status de exemplo para apresentação (3 bolinhas: Equipamentos, Pessoal, Certificação)
        const statusExemplosFixos = {
            // PANAMAX
            "ANITA GARIBALDI": ['yellow', 'green', 'green'],

            // AFRAMAX
            "CASTRO ALVES": ['green', 'green', 'yellow'],
            "CARLOS DRUMMOND DE ANDRADE": ['red', 'yellow', 'green'],
            "OLAVO BILAC": ['green', 'yellow', 'green'],
            "GARRINCHA": ['green', 'green', 'red'],
            "PORTINARI": ['green', 'green', 'green'],

            // SUEZMAX
            "JOAO CANDIDO": ['yellow', 'green', 'red'],
            "DRAGAO DO MAR": ['green', 'green', 'gray'],
            "HENRIQUE DIAS": ['yellow', 'green', 'green'],
            "ANDRE REBOUCAS": ['green', 'green', 'green'],
            "MARCILIO DIAS": ['green', 'yellow', 'green'],
            "JOSE DO PATROCINIO": ['red', 'yellow', 'green'],
            "MACHADO DE ASSIS": ['yellow', 'green', 'green'],
            "MILTON SANTOS": ['green', 'red', 'green'],
            "ABDIAS NASCIMENTO": ['green', 'green', 'gray'],
            "ZUMBI DOS PALMARES": ['green', 'green', 'yellow'],

            // PRODUTOS
            "CELSO FURTADO": ['green', 'yellow', 'green'],
            "SERGIO BUARQUE DE HOLANDA": ['green', 'green', 'yellow'],
            "ROMULO ALMEIDA": ['red', 'green', 'green'],
            "JOSE ALENCAR": ['yellow', 'yellow', 'green'],

            // GASEIRO 7K
            "LUCIO COSTA": ['green', 'green', 'yellow'],
            "DARCY RIBEIRO": ['green', 'gray', 'green'],
            "BARBOSA LIMA SOBRINHO": ['green', 'green', 'yellow'],
            "OSCAR NIEMEYER": ['yellow', 'gray', 'green'],

            // GASEIRO 4K
            "GILBERTO FREYRE": ['green', 'yellow', 'green'],
            "JORGE AMADO": ['green', 'green', 'gray']
        };

        const statusNames = {
            'green': 'Operacional',
            'yellow': 'Atenção',
            'red': 'Crítico',
            'gray': 'Sem dados'
        };

        const statusMapping = {
            'Verde': 'green',
            'Amarelo': 'yellow',
            'Vermelho': 'red',
            'Cinza': 'gray',
            'Green': 'green',
            'Yellow': 'yellow',
            'Red': 'red',
            'Gray': 'gray'
        };

        let dadosNavios = [];

        function initDadosCompletos() {
            dadosNaviosCompletos = naviosReais.map(navio => ({
                nome: navio.nome,
                classe: navio.classe,
                CMT: '',
                CFM: '',
                IMT: ''
            }));
        }


        // Filtro de classes - agora suporta múltipla seleção
        let currentClassFilter = []; // Array vazio = todas as classes
        let selectedClassesTemp = []; // Seleção temporária no popup

        // Função para renderizar chips no popup
        // Definição dos grupos de navegação
        const GRUPOS_NAVEGACAO = {
            'Longo Curso': ['Suezmax', 'Aframax'],
            'Cabotagem': ['Panamax', 'Produtos', 'Gaseiro 7k', 'Gaseiro 4k']
        };

        function renderizarChipsFiltro() {
            const container = document.getElementById('filterChipsContainer');
            if (!container) return;

            const classes = ['Panamax', 'Aframax', 'Suezmax', 'Produtos', 'Gaseiro 7k', 'Gaseiro 4k'];
            const contadores = {};

            // Contar navios por classe
            naviosReais.forEach(navio => {
                contadores[navio.classe] = (contadores[navio.classe] || 0) + 1;
            });

            let html = '';

            // ── Chips de grupo (Longo Curso / Cabotagem) ──────────────────
            Object.entries(GRUPOS_NAVEGACAO).forEach(([grupo, classesDoGrupo]) => {
                const totalGrupo = classesDoGrupo.reduce((sum, c) => sum + (contadores[c] || 0), 0);
                const todasAtivas = classesDoGrupo.every(c => selectedClassesTemp.includes(c));
                const isActive = todasAtivas ? ' active' : '';
                html += `<div class="filter-chip grupo${isActive}" onclick="toggleGrupoClasse('${grupo}')">
                    ${grupo}
                    <span class="chip-count">${totalGrupo}</span>
                </div>`;
            });

            // ── Separador ─────────────────────────────────────────────────
            html += '<hr class="filter-chips-separator">';

            // ── Chips de classe individual ────────────────────────────────
            classes.forEach(classe => {
                const count = contadores[classe] || 0;
                const isActive = selectedClassesTemp.includes(classe) ? ' active' : '';
                html += `<div class="filter-chip${isActive}" onclick="toggleChipClasse('${classe}')">
                    ${classe}
                    <span class="chip-count">${count}</span>
                </div>`;
            });

            container.innerHTML = html;
        }

        // Toggle de classe individual
        function toggleChipClasse(classe) {
            const index = selectedClassesTemp.indexOf(classe);
            if (index > -1) {
                selectedClassesTemp.splice(index, 1);
            } else {
                selectedClassesTemp.push(classe);
            }
            renderizarChipsFiltro();
        }

        // Toggle de grupo: se todas as classes do grupo estão ativas, desativa todas; senão ativa todas
        function toggleGrupoClasse(grupo) {
            const classesDoGrupo = GRUPOS_NAVEGACAO[grupo];
            if (!classesDoGrupo) return;

            const todasAtivas = classesDoGrupo.every(c => selectedClassesTemp.includes(c));

            if (todasAtivas) {
                // Desativar todas as classes do grupo
                selectedClassesTemp = selectedClassesTemp.filter(c => !classesDoGrupo.includes(c));
            } else {
                // Ativar todas as classes do grupo que ainda não estão ativas
                classesDoGrupo.forEach(c => {
                    if (!selectedClassesTemp.includes(c)) {
                        selectedClassesTemp.push(c);
                    }
                });
            }
            renderizarChipsFiltro();
        }

        // Função para limpar seleção
        function limparFiltrosClasse() {
            selectedClassesTemp = [];
            renderizarChipsFiltro();
        }

        // Função para aplicar filtros
        function aplicarFiltrosClasse() {
            currentClassFilter = [...selectedClassesTemp];
            closeFilterPopup();
            atualizarVisualFiltroClasse();
            applyAllFilters();
        }

        // Modificar toggleFilterPopup para inicializar chips
        const originalToggleFilterPopup = typeof toggleFilterPopup === 'function' ? toggleFilterPopup : null;





        // Função para reconstruir o dashboard
        function rebuildDashboard() {
            // Limpar grids existentes
            document.getElementById('shipList').innerHTML = '';
            document.getElementById('systemsGrid').innerHTML = '';

            // Reconstruir com novos dados
            renderShipList();
            renderSystemsGrid();

            // Reaplicar modo atual
            if (currentMode === 'compact') {
                setViewMode('compact');
            }
        }

        // Função para mostrar mensagens
        function showMessage(text, type) {
            const msg = document.getElementById('statusMessage');
            msg.textContent = text;
            msg.className = `status-message ${type}`;
            msg.style.display = 'block';

            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        function renderShipList() {
            const shipList = document.getElementById('shipList');

            // Salvar o filtro antes de limpar
            const filterContainer = shipList.querySelector('.filter-dropdown-container');

            const shipItems = shipList.querySelectorAll('.ship-item');
            shipItems.forEach(item => item.remove());

            // Usar dados carregados ou dados de exemplo
            const numShips = dadosNavios.length > 0 ? dadosNavios.length : 26;

            for (let i = 1; i <= numShips; i++) {
                const shipItem = document.createElement('div');
                shipItem.className = 'ship-item';
                shipItem.setAttribute('data-ship-number', i); // Adicionar atributo para filtro

                const navio = naviosReais[i - 1];
                shipItem.innerHTML = `
                    <div>${navio.nome}</div>
                    <div style="font-size: 9px; color: rgba(255,255,255,0.5); font-style: italic;">${navio.classe}</div>
                `;

                shipItem.onclick = () => scrollToShip(i);
                shipList.appendChild(shipItem);
            }
        }

        // Ordem de exibição das classes (da esquerda pra direita, de cima pra baixo)
        const ordemClasses = ['Panamax', 'Aframax', 'Suezmax', 'Produtos', 'Gaseiro 7k', 'Gaseiro 4k'];

        function renderSystemsGrid() {
            const grid = document.getElementById('systemsGrid');
            let greenTotal = 0, yellowTotal = 0, redTotal = 0, grayTotal = 0;

            grid.innerHTML = '';

            // Array já está na ordem correta por classe, então iterar diretamente
            naviosReais.forEach((navio, index) => {
                const row = document.createElement('div');
                row.className = 'ship-row';
                row.id = `ship-${index + 1}`;
                row.setAttribute('data-ship-number', index + 1);
                row.setAttribute('data-classe', navio.classe);

                const nameDiv = document.createElement('div');
                nameDiv.className = 'ship-name';
                nameDiv.style.cursor = 'pointer';

                nameDiv.innerHTML = `
                    <div>${navio.nome}</div>
                    <div class="ship-class">${navio.classe}</div>
                `;

                nameDiv.onclick = (e) => {
                    e.stopPropagation();
                    irParaPerfilNavio(index);
                };

                row.appendChild(nameDiv);

                const indicatorsDiv = document.createElement('div');
                indicatorsDiv.className = 'status-indicators';

                // Usar status resumido por categoria (3 bolinhas)
                const shipStatus = calcularStatusResumo(navio.nome);
                shipStatus.forEach((status, idx) => {
                    const circle = document.createElement('div');
                    circle.className = `status-circle ${status}`;
                    circle.style.cursor = 'pointer';

                    // Adicionar clique para ir ao perfil do navio com destaque na categoria
                    circle.onclick = (e) => {
                        e.stopPropagation();
                        irParaPerfilNavio(index, idx);
                    };

                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = sistemas[idx];
                    circle.appendChild(tooltip);

                    indicatorsDiv.appendChild(circle);

                    if (status === 'green') greenTotal++;
                    else if (status === 'yellow') yellowTotal++;
                    else if (status === 'red') redTotal++;
                    else if (status === 'gray') grayTotal++;
                });

                row.appendChild(indicatorsDiv);
                grid.appendChild(row);
            });

            document.getElementById('greenCount').textContent = greenTotal;
            document.getElementById('yellowCount').textContent = yellowTotal;
            document.getElementById('redCount').textContent = redTotal;
            document.getElementById('grayCount').textContent = grayTotal;
        }

        function scrollToShip(shipNumber) {
            const shipRow = document.getElementById(`ship-${shipNumber}`);
            shipRow.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Highlight temporário
            shipRow.style.background = 'rgba(149, 165, 166, 0.3)';
            setTimeout(() => {
                shipRow.style.background = 'rgba(255, 255, 255, 0.05)';
            }, 2000);
        }

        // Função para calcular e atualizar contadores de classes dinamicamente
        function atualizarContadoresClasses() {
            // Contar navios por classe
            const contadores = {};
            naviosReais.forEach(navio => {
                contadores[navio.classe] = (contadores[navio.classe] || 0) + 1;
            });

            // Criar array ordenado do maior para o menor
            const classesOrdenadas = Object.entries(contadores)
                .sort((a, b) => b[1] - a[1])
                .map(([classe, count]) => ({ classe, count }));

            // Gerar HTML do popup principal (agora usa chips - ver renderizarChipsFiltro)
            // Esta parte foi substituída pelos chips, mas mantemos para compatibilidade
            const popupContainer = document.getElementById('filterPopupItems');
            if (popupContainer) {
                // Não mais usado - chips são renderizados por renderizarChipsFiltro()
            }

            // Gerar HTML do dropdown secundário (modo normal)
            const dropdownContainer = document.getElementById('filterDropdownItems');
            if (dropdownContainer) {
                let html = `<div class="filter-dropdown-item${currentClassFilter.length === 0 ? ' active' : ''}" onclick="filterByClass('Todas')">
                    Todas <span class="count">(${naviosReais.length})</span>
                </div>`;
                classesOrdenadas.forEach(({ classe, count }) => {
                    const isActive = currentClassFilter.includes(classe) ? ' active' : '';
                    html += `<div class="filter-dropdown-item${isActive}" onclick="filterByClass('${classe}')">
                        ${classe} <span class="count">(${count})</span>
                    </div>`;
                });
                dropdownContainer.innerHTML = html;
            }
        }

        // ============================================
        // INTEGRAÇÃO COM SHAREPOINT - StatusNavios
        // ============================================

        const SHAREPOINT_SITE = 'https://transpetro.sharepoint.com/sites/EstadoGeralDosNavios2';
        const LISTA_NAME = 'StatusNavios';

        // Todos os campos necessários declarados explicitamente
        const CAMPOS_SELECT = [
            'NomeNavio', 'DataPreenchimento',
            // Equipamentos (Choice 1/2/3) + Observações
            'MotorPrincipal', 'MotorPrincipalObs',
            'MCAs', 'MCAsObs',
            'GrupoDestilatorio', 'GrupoDestilatorioObs',
            'EquipFundeio', 'EquipFundeioObs',
            'CaldeirasAuxiliares', 'CaldeirasAuxiliaresObs',
            'DGEBBAIncendio', 'DGEBBAIncendioObs',
            'SistemaCargaDescarga', 'SistemaCargaDescargaObs',
            'MaquinaLeme', 'MaquinaLemeObs',
            'Purificadores', 'PurificadoresObs',
            'SistemasNavegacao', 'SistemasNavegacaoObs',
            'EstadoGeralConves', 'EstadoGeralConvesObs',
            'EstadoGeralPM', 'EstadoGeralPMObs',
            // Pessoal
            'TrifixPercentual', 'TrifixObs',
            'TripulantesVencidos', 'TripulantesVencidosObs',
            'CrewMatrix', 'CrewMatrixObs',
            'CertificacaoTripulante', 'CertificacaoTripulanteObs',
            // Certificação
            'DiasParaVencerDoc', 'PendenciaDocObs',
            'CondicaoClasse', 'CondicaoClasseObs',
            'VettingObservacoes', 'VettingObs'
        ].join(',');

        const API_URL = `${SHAREPOINT_SITE}/_api/web/lists/getbytitle('${LISTA_NAME}')/items` +
            `?$select=${CAMPOS_SELECT}` +
            `&$orderby=DataPreenchimento desc` +
            `&$top=500`;

        // Busca dados do SharePoint via REST API
        // MODO TESTE: false = dados reais do SharePoint | true = dados simulados
        const MODO_TESTE = false;

        async function buscarDadosSharePoint() {

            // ── DADOS MOCK (simula retorno real da REST API do SharePoint) ──────
            if (MODO_TESTE) {
                console.log('🧪 MODO TESTE ativo — usando dados simulados');
                return [
                    { NomeNavio: 'ANITA GARIBALDI', MotorPrincipal: '1', MCAs: '2', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '2', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 85, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 120, CondicaoClasse: '1', VettingObservacoes: 3 },
                    { NomeNavio: 'CASTRO ALVES', MotorPrincipal: '3', MCAs: '1', GrupoDestilatorio: '2', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '2', EstadoGeralPM: '1', TrifixPercentual: 60, TripulantesVencidos: '2', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 45, CondicaoClasse: '1', VettingObservacoes: 8 },
                    { NomeNavio: 'CARLOS DRUMMOND DE ANDRADE', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '2', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '2', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 90, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 200, CondicaoClasse: '1', VettingObservacoes: 2 },
                    { NomeNavio: 'OLAVO BILAC', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '3', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '3', TrifixPercentual: 40, TripulantesVencidos: '3', CrewMatrix: '3', CertificacaoTripulante: '1', DiasParaVencerDoc: 15, CondicaoClasse: '3', VettingObservacoes: 14 },
                    { NomeNavio: 'GARRINCHA', MotorPrincipal: '2', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '2', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 75, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '2', DiasParaVencerDoc: 60, CondicaoClasse: '1', VettingObservacoes: 7 },
                    { NomeNavio: 'PORTINARI', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 95, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 300, CondicaoClasse: '1', VettingObservacoes: 1 },
                    { NomeNavio: 'JOAO CANDIDO', MotorPrincipal: '1', MCAs: '3', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 82, TripulantesVencidos: '2', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 100, CondicaoClasse: '1', VettingObservacoes: 5 },
                    { NomeNavio: 'DRAGAO DO MAR', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '2', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 88, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 150, CondicaoClasse: '1', VettingObservacoes: 4 },
                    { NomeNavio: 'HENRIQUE DIAS', MotorPrincipal: '2', MCAs: '2', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '2', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '2', EstadoGeralPM: '1', TrifixPercentual: 55, TripulantesVencidos: '2', CrewMatrix: '2', CertificacaoTripulante: '1', DiasParaVencerDoc: 40, CondicaoClasse: '2', VettingObservacoes: 9 },
                    { NomeNavio: 'ANDRE REBOUCAS', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 92, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 250, CondicaoClasse: '1', VettingObservacoes: 2 },
                    { NomeNavio: 'MARCILIO DIAS', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '3', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '3', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 70, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '3', DiasParaVencerDoc: 20, CondicaoClasse: '1', VettingObservacoes: 13 },
                    { NomeNavio: 'JOSE DO PATROCINIO', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '2', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 78, TripulantesVencidos: '2', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 80, CondicaoClasse: '1', VettingObservacoes: 6 },
                    { NomeNavio: 'LUCIO COSTA', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '2', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 86, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 110, CondicaoClasse: '1', VettingObservacoes: 3 },
                    { NomeNavio: 'MACHADO DE ASSIS', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 97, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 400, CondicaoClasse: '1', VettingObservacoes: 0 },
                    { NomeNavio: 'MILTON SANTOS', MotorPrincipal: '2', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '2', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 65, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 55, CondicaoClasse: '2', VettingObservacoes: 8 },
                    { NomeNavio: 'ABDIAS NASCIMENTO', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 91, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 180, CondicaoClasse: '1', VettingObservacoes: 2 },
                    { NomeNavio: 'DARCY RIBEIRO', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '3', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 83, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 95, CondicaoClasse: '1', VettingObservacoes: 5 },
                    { NomeNavio: 'CELSO FURTADO', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '2', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '2', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 72, TripulantesVencidos: '2', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 70, CondicaoClasse: '1', VettingObservacoes: 7 },
                    { NomeNavio: 'SERGIO BUARQUE DE HOLANDA', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 89, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 220, CondicaoClasse: '1', VettingObservacoes: 1 },
                    { NomeNavio: 'ROMULO ALMEIDA', MotorPrincipal: '1', MCAs: '2', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '2', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 68, TripulantesVencidos: '1', CrewMatrix: '2', CertificacaoTripulante: '1', DiasParaVencerDoc: 35, CondicaoClasse: '1', VettingObservacoes: 10 },
                    { NomeNavio: 'ZUMBI DOS PALMARES', MotorPrincipal: '3', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '3', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 45, TripulantesVencidos: '3', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 10, CondicaoClasse: '3', VettingObservacoes: 15 },
                    { NomeNavio: 'JOSE ALENCAR', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 94, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 310, CondicaoClasse: '1', VettingObservacoes: 2 },
                    { NomeNavio: 'BARBOSA LIMA SOBRINHO', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '2', EquipFundeio: '2', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '2', EstadoGeralPM: '1', TrifixPercentual: 76, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 65, CondicaoClasse: '1', VettingObservacoes: 6 },
                    { NomeNavio: 'OSCAR NIEMEYER', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 98, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 365, CondicaoClasse: '1', VettingObservacoes: 0 },
                    { NomeNavio: 'GILBERTO FREYRE', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '2', DGEBBAIncendio: '1', SistemaCargaDescarga: '2', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '2', TrifixPercentual: 58, TripulantesVencidos: '2', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 50, CondicaoClasse: '1', VettingObservacoes: 8 },
                    { NomeNavio: 'JORGE AMADO', MotorPrincipal: '1', MCAs: '1', GrupoDestilatorio: '1', EquipFundeio: '1', CaldeirasAuxiliares: '1', DGEBBAIncendio: '1', SistemaCargaDescarga: '1', MaquinaLeme: '1', Purificadores: '1', SistemasNavegacao: '1', EstadoGeralConves: '1', EstadoGeralPM: '1', TrifixPercentual: 87, TripulantesVencidos: '1', CrewMatrix: '1', CertificacaoTripulante: '1', DiasParaVencerDoc: 130, CondicaoClasse: '1', VettingObservacoes: 4 },
                ];
            }
            // ── FIM DADOS MOCK ────────────────────────────────────────────────

            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json;odata=verbose',
                        'Content-Type': 'application/json;odata=verbose'
                    },
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const data = await response.json();
                return data.d.results;
            } catch (error) {
                console.error('Erro ao buscar dados do SharePoint:', error);
                return null;
            }
        }

        // Converte campo Choice do SharePoint para cor
        // SharePoint retorna a string completa: "1 - Operacional", "2 - Atenção", "3 - Crítico"
        // Suporta também retorno como objeto { Value: "1 - Operacional" } ou número puro
        function converterParaCor(valor) {
            if (valor === null || valor === undefined || valor === '') return 'gray';

            // Se vier como objeto Choice (Power Apps às vezes retorna assim)
            if (typeof valor === 'object' && valor.Value) {
                valor = valor.Value;
            }

            // Extrair o número do início da string ou usar o valor diretamente
            const num = typeof valor === 'string'
                ? parseInt(valor.charAt(0))
                : parseInt(valor);

            switch (num) {
                case 1: return 'green';
                case 2: return 'yellow';
                case 3: return 'red';
                default: return 'gray';
            }
        }

        // TrifixPercentual — campo Número: >=80% verde, 50-79% amarelo, <50% vermelho
        function converterTrifix(percentual) {
            if (percentual === null || percentual === undefined || percentual === '') return 'gray';
            const val = parseFloat(percentual);
            if (isNaN(val)) return 'gray';
            if (val >= 80) return 'green';
            if (val >= 50) return 'yellow';
            return 'red';
        }

        // TripulantesVencidos — foi trocado para Choice, usa mesma lógica 1/2/3
        function converterTripulantesVencidos(valor) {
            return converterParaCor(valor);
        }

        // DiasParaVencerDoc — campo Número: >90 verde, 30-90 amarelo, <30 vermelho
        function converterDiasParaVencer(dias) {
            if (dias === null || dias === undefined || dias === '') return 'gray';
            const val = parseFloat(dias);
            if (isNaN(val)) return 'gray';
            if (val > 90) return 'green';
            if (val >= 30) return 'yellow';
            return 'red';
        }

        // VettingObservacoes — campo Número: <=6 verde, 7-12 amarelo, >12 vermelho
        function converterVetting(observacoes) {
            if (observacoes === null || observacoes === undefined || observacoes === '') return 'gray';
            const val = parseFloat(observacoes);
            if (isNaN(val)) return 'gray';
            if (val <= 6) return 'green';
            if (val <= 12) return 'yellow';
            return 'red';
        }

        // Calcula o pior status de um array de cores
        // Prioridade: vermelho > amarelo > verde > cinza (cinza = sem dado)
        function calcularPiorStatus(cores) {
            if (cores.every(c => c === 'gray')) return 'gray';
            if (cores.includes('red')) return 'red';
            if (cores.includes('yellow')) return 'yellow';
            return 'green';
        }

        // Processa um registro do SharePoint e retorna [corEquipamentos, corPessoal, corCertificacao]
        function processarDadosNavioSharePoint(item) {
            // EQUIPAMENTOS — 12 campos Choice (1/2/3)
            const coresEquipamentos = [
                converterParaCor(item.MotorPrincipal),
                converterParaCor(item.MCAs),
                converterParaCor(item.GrupoDestilatorio),
                converterParaCor(item.EquipFundeio),
                converterParaCor(item.CaldeirasAuxiliares),
                converterParaCor(item.DGEBBAIncendio),
                converterParaCor(item.SistemaCargaDescarga),
                converterParaCor(item.MaquinaLeme),
                converterParaCor(item.Purificadores),
                converterParaCor(item.SistemasNavegacao),
                converterParaCor(item.EstadoGeralConves),
                converterParaCor(item.EstadoGeralPM)
            ];

            // PESSOAL — 2 numéricos + 2 Choice
            const coresPessoal = [
                converterTrifix(item.TrifixPercentual),
                converterTripulantesVencidos(item.TripulantesVencidos),
                converterParaCor(item.CrewMatrix),
                converterParaCor(item.CertificacaoTripulante)
            ];

            // CERTIFICAÇÃO — 1 numérico + 1 Choice + 1 numérico
            const coresCertificacao = [
                converterDiasParaVencer(item.DiasParaVencerDoc),
                converterParaCor(item.CondicaoClasse),
                converterVetting(item.VettingObservacoes)
            ];

            return [
                calcularPiorStatus(coresEquipamentos),
                calcularPiorStatus(coresPessoal),
                calcularPiorStatus(coresCertificacao)
            ];
        }

        // Função para carregar dados reais do SharePoint
        async function carregarDadosReais() {
            console.log('🔄 Carregando dados do SharePoint...');

            const dados = await buscarDadosSharePoint();

            if (!dados || dados.length === 0) {
                console.warn('⚠️ Não foi possível carregar dados do SharePoint. Usando dados de exemplo.');
                return false;
            }

            console.log(`✅ Encontrados ${dados.length} registros no SharePoint`);

            // Pegar dado mais recente de cada navio
            dadosSharePoint = {};
            dados.forEach(item => {
                const nomeNavio = item.NomeNavio;
                if (nomeNavio && !dadosSharePoint[nomeNavio]) {
                    dadosSharePoint[nomeNavio] = item;

                    // Atualizar tripulação se os campos existirem
                    atualizarTripulacaoNavio(nomeNavio, item);
                }
            });

            console.log(`📊 Dados processados para ${Object.keys(dadosSharePoint).length} navios`);

            // Re-renderizar o grid com dados reais
            renderSystemsGrid();
            atualizarContadoresClasses();

            // Atualizar visual
            setTimeout(() => {
                setViewMode('compact');
            }, 100);

            return true;
        }

        // Tripulação (CMT/CFM/IMT) não faz parte da lista StatusNavios atual.
        // Mantida para compatibilidade futura quando esses campos forem adicionados.
        function atualizarTripulacaoNavio(nomeNavio, dados) {
            // sem campos de tripulação na lista atual — nenhuma ação necessária
        }

        // Inicializar
        initDadosCompletos();
        renderShipList();
        renderSystemsGrid();
        atualizarContadoresClasses();

        // Tentar carregar dados do SharePoint após inicialização
        setTimeout(() => {
            carregarDadosReais();
        }, 500);

        // Iniciar no modo compacto
        setTimeout(() => {
            setViewMode('compact');
        }, 100);

        // Modo de visualização
        let currentMode = 'compact';

        // Função para toggle do dropdown de filtro
        function toggleFilterDropdown() {
            const dropdown = document.getElementById('filterDropdown');
            dropdown.classList.toggle('active');
        }

        // ============================================
        // MODO PRIVACIDADE - Ocultar nomes
        // Estados: 0 = visível, 1 = traços, 2 = oculto 2col, 3 = oculto 3col
        // ============================================
        let privacyMode = 0;

        function togglePrivacyMode() {
            // Ciclar entre os 4 estados: 0 → 1 → 2 → 3 → 0
            privacyMode = (privacyMode + 1) % 4;

            const btn = document.getElementById('btnPrivacy');
            const tooltip = btn.querySelector('.tooltip-home');
            const svg = btn.querySelector('svg');

            // Elementos para manipular
            const crewSections = document.querySelectorAll('.crew-section');
            const crewHeaders = document.querySelectorAll('.crew-header-section');

            // SVG do olho aberto
            const eyeOpen = `<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>`;

            // SVG do olho com linha diagonal (traços)
            const eyeSlash = `<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>`;

            // SVG do olho com X (oculto 2 colunas)
            const eyeX = `<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/><path d="M9.17 9.17L14.83 14.83M14.83 9.17L9.17 14.83" stroke="white" stroke-width="2" stroke-linecap="round"/>`;

            // SVG do olho com ! (ultra compacto 3 colunas)
            const eyeExclaim = `<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/><text x="12" y="14" text-anchor="middle" fill="white" font-size="8" font-weight="bold">!</text>`;

            if (privacyMode === 0) {
                // Estado 0: Tudo visível - restaurar nomes originais
                btn.classList.remove('active');
                svg.innerHTML = eyeOpen;
                tooltip.textContent = 'Ocultar nomes';

                // Restaurar nomes originais
                crewSections.forEach(el => {
                    if (el.hasAttribute('data-original-text')) {
                        el.innerHTML = el.getAttribute('data-original-text');
                        el.style.fontWeight = '';
                    }
                    el.classList.remove('privacy-hidden');
                });
                crewHeaders.forEach(el => {
                    el.classList.remove('privacy-hidden');
                });

                // Remover modos
                const systemsGrid = document.querySelector('.systems-grid.compact');
                if (systemsGrid) {
                    systemsGrid.classList.remove('ultra-compact');
                    systemsGrid.classList.remove('privacy-compact');
                }
                reorganizarColunas(2);

            } else if (privacyMode === 1) {
                // Estado 1: Substituir nomes por "- - -"
                btn.classList.add('active');
                svg.innerHTML = eyeSlash;
                tooltip.textContent = 'Ocultar tripulação';

                // Salvar texto original e substituir por traços
                crewSections.forEach(el => {
                    if (!el.hasAttribute('data-original-text')) {
                        el.setAttribute('data-original-text', el.innerHTML);
                    }
                    el.innerHTML = '<b>- - -</b>';
                    el.style.fontWeight = 'bold';
                    el.classList.remove('privacy-hidden');
                });
                crewHeaders.forEach(el => {
                    el.classList.remove('privacy-hidden');
                });

                // Remover modos
                const systemsGrid = document.querySelector('.systems-grid.compact');
                if (systemsGrid) {
                    systemsGrid.classList.remove('ultra-compact');
                    systemsGrid.classList.remove('privacy-compact');
                }
                reorganizarColunas(2);

            } else if (privacyMode === 2) {
                // Estado 2: Ocultar colunas completamente (2 colunas)
                btn.classList.add('active');
                svg.innerHTML = eyeX;
                tooltip.textContent = 'Modo compacto';

                // Adicionar classe para ocultar via CSS
                const systemsGrid = document.querySelector('.systems-grid.compact');
                if (systemsGrid) {
                    systemsGrid.classList.remove('ultra-compact');
                    systemsGrid.classList.add('privacy-compact');
                }

                reorganizarColunas(2);

            } else if (privacyMode === 3) {
                // Estado 3: Ultra compacto (3 colunas)
                btn.classList.add('active');
                svg.innerHTML = eyeExclaim;
                tooltip.textContent = 'Exibir tripulação';

                // Adicionar classes para modo ultra compacto
                const systemsGrid = document.querySelector('.systems-grid.compact');
                if (systemsGrid) {
                    systemsGrid.classList.add('ultra-compact');
                    systemsGrid.classList.add('privacy-compact');
                }

                reorganizarColunas(3);
            }
        }

        // Função para reorganizar navios em 2 ou 3 colunas
        function reorganizarColunas(numColunas) {
            const systemsGrid = document.querySelector('.systems-grid.compact');
            if (!systemsGrid) return;

            // Coletar TODOS os ship-rows
            const allRows = Array.from(systemsGrid.querySelectorAll('.ship-row.compact-mode'));

            // Separar visíveis e ocultos
            const visibleRows = allRows.filter(row => row.style.display !== 'none');
            const hiddenRows = allRows.filter(row => row.style.display === 'none');

            // Ordenar visíveis por data-ship-number para manter ordem consistente
            visibleRows.sort((a, b) => {
                const numA = parseInt(a.getAttribute('data-ship-number')) || 0;
                const numB = parseInt(b.getAttribute('data-ship-number')) || 0;
                return numA - numB;
            });

            // Remover colunas existentes
            const existingColumns = systemsGrid.querySelectorAll('.column-container');
            existingColumns.forEach(col => col.remove());

            // Criar novas colunas
            const columns = [];
            for (let i = 0; i < numColunas; i++) {
                const col = document.createElement('div');
                col.className = 'column-container';

                // Criar header para cada coluna
                const header = document.createElement('div');
                header.className = 'compact-column-header';

                // Determinar quais headers mostrar baseado no privacyMode
                if (privacyMode === 3) {
                    // Modo ultra compacto (3 colunas) - apenas NAVIO
                    header.innerHTML = `
                        <div class="compact-header-name" onclick="toggleFilterPopup()" style="cursor: pointer;" title="Clique para filtrar">
                            <svg class="filter-icon-header" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 5px; opacity: 0.6;">
                                <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z"/>
                            </svg>
                            Navio
                        </div>
                        <span class="classe-filter-badge"></span>
                    `;
                } else if (privacyMode === 2) {
                    // Modo compacto (2 colunas) - NAVIO e IDADE
                    header.innerHTML = `
                        <div class="compact-header-name" onclick="toggleFilterPopup()" style="cursor: pointer;" title="Clique para filtrar">
                            <svg class="filter-icon-header" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 5px; opacity: 0.6;">
                                <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z"/>
                            </svg>
                            Navio
                        </div>
                        <div class="compact-header-section compact-header-idade" title="Idade da Embarcação">IDADE</div>
                        <span class="classe-filter-badge"></span>
                    `;
                } else {
                    // Modo normal - todos os headers
                    header.innerHTML = `
                        <div class="compact-header-name" onclick="toggleFilterPopup()" style="cursor: pointer;" title="Clique para filtrar">
                            <svg class="filter-icon-header" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 5px; opacity: 0.6;">
                                <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z"/>
                            </svg>
                            Navio
                        </div>
                        <div class="compact-header-section crew-header-section" title="Comandante">CMT</div>
                        <div class="compact-header-section crew-header-section" title="Chefe de Máquinas">CFM</div>
                        <div class="compact-header-section crew-header-section" title="Imediato">IMT</div>
                        <div class="compact-header-section compact-header-idade" title="Idade da Embarcação">IDADE</div>
                        <span class="classe-filter-badge"></span>
                    `;
                }

                col.appendChild(header);
                columns.push(col);
                systemsGrid.appendChild(col);
            }

            // Distribuição sequencial: primeira metade col0, segunda col1, etc.
            const porColuna1 = Math.ceil(visibleRows.length / numColunas);
            visibleRows.forEach((row, index) => {
                const columnIndex = Math.min(Math.floor(index / porColuna1), numColunas - 1);
                columns[columnIndex].appendChild(row);
            });

            // Adicionar navios ocultos na primeira coluna (não afeta layout)
            hiddenRows.forEach(row => {
                columns[0].appendChild(row);
            });

            // Atualizar visual do filtro de classe
            atualizarVisualFiltroClasse();

            // Redesenhar linhas verticais
            if (currentMode === 'compact') {
                addThirdAndFourthVerticalLines();
            }
        }

        // Funções para filtro popup (modo compacto)
        function toggleFilterPopup() {
            const popup = document.getElementById('filterPopup');
            const overlay = document.getElementById('filterOverlay');

            // Se está abrindo, inicializar seleção temporária com filtro atual
            if (!popup.classList.contains('active')) {
                selectedClassesTemp = [...currentClassFilter];
                renderizarChipsFiltro();
            }

            popup.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function closeFilterPopup() {
            const popup = document.getElementById('filterPopup');
            const overlay = document.getElementById('filterOverlay');
            popup.classList.remove('active');
            overlay.classList.remove('active');
        }


        // Variável para controlar filtro de cor ativo
        let currentColorFilter = null;

        // Função para filtrar embarcações por cor
        function filterByColor(color) {
            // Se clicar no mesmo filtro, desativa
            if (currentColorFilter === color) {
                currentColorFilter = null;
                document.querySelectorAll('.stat-card').forEach(card => {
                    card.classList.remove('active-filter');
                });
            } else {
                currentColorFilter = color;
                document.querySelectorAll('.stat-card').forEach(card => {
                    card.classList.remove('active-filter');
                });
                document.getElementById('filter' + color.charAt(0).toUpperCase() + color.slice(1)).classList.add('active-filter');
            }

            applyAllFilters();
        }

        // Função para aplicar todos os filtros (classe + cor)
        function applyAllFilters() {
            const allShipRows = document.querySelectorAll('.ship-row');
            const visibleShipNumbers = [];

            allShipRows.forEach((row) => {
                const shipNumber = parseInt(row.getAttribute('data-ship-number'));
                const navio = naviosReais[shipNumber - 1];

                if (!navio) return;

                // Verificar filtro de classe (array vazio = todas)
                const passaFiltroClasse = currentClassFilter.length === 0 || currentClassFilter.includes(navio.classe);

                // Verificar filtro de cor
                let passaFiltroCor = true;
                if (currentColorFilter) {
                    const shipStatus = calcularStatusResumo(navio.nome);
                    passaFiltroCor = shipStatus.includes(currentColorFilter);
                }

                if (passaFiltroClasse && passaFiltroCor) {
                    row.style.display = 'grid';
                    visibleShipNumbers.push(shipNumber);
                } else {
                    row.style.display = 'none';
                }
            });

            redistributeVisibleRows(visibleShipNumbers);
            updateFilteredStats();

            if (currentMode === 'compact') {
                addThirdAndFourthVerticalLines();
            }
        }

        function filterByClassPopup(classe) {
            // Função legada - converte para array
            if (classe === 'Todas') {
                currentClassFilter = [];
            } else {
                currentClassFilter = [classe];
            }

            closeFilterPopup();

            atualizarContadoresClasses();
            atualizarVisualFiltroClasse();

            applyAllFilters();
        }

        // Função para atualizar visual quando filtro de classe está ativo
        function atualizarVisualFiltroClasse() {
            const headerNames = document.querySelectorAll('.compact-header-name');
            const badges = document.querySelectorAll('.classe-filter-badge');

            if (currentClassFilter.length > 0) {
                headerNames.forEach(header => header.classList.add('filter-active'));

                // Verificar se o filtro ativo corresponde exatamente a um grupo
                function filtroEhGrupo(nomeGrupo) {
                    const classesGrupo = GRUPOS_NAVEGACAO[nomeGrupo];
                    if (!classesGrupo) return false;
                    const filtroOrdenado = [...currentClassFilter].sort().join(',');
                    const grupoOrdenado = [...classesGrupo].sort().join(',');
                    return filtroOrdenado === grupoOrdenado;
                }

                let labelBadge;
                if (filtroEhGrupo('Longo Curso')) {
                    labelBadge = 'Longo Curso';
                } else if (filtroEhGrupo('Cabotagem')) {
                    labelBadge = 'Cabotagem';
                } else if (currentClassFilter.length === 1) {
                    labelBadge = currentClassFilter[0];
                } else {
                    labelBadge = currentClassFilter.length + ' classes';
                }

                badges.forEach(badge => {
                    badge.textContent = labelBadge;
                    badge.classList.add('active');
                });
            } else {
                headerNames.forEach(header => header.classList.remove('filter-active'));
                badges.forEach(badge => badge.classList.remove('active'));
            }
        }

        document.addEventListener('click', function (event) {
            const dropdown = document.getElementById('filterDropdown');
            const button = document.querySelector('.filter-dropdown-btn');

            if (dropdown && button) {
                if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                    dropdown.classList.remove('active');
                }
            }
        });

        function filterByClass(classe) {
            // Função legada - converte para array
            if (classe === 'Todas') {
                currentClassFilter = [];
            } else {
                currentClassFilter = [classe];
            }

            document.getElementById('filterLabel').textContent = classe;

            document.getElementById('filterDropdown').classList.remove('active');

            atualizarContadoresClasses();

            applyAllFilters();
        }

        function applyClassFilter(classe) {
            const allShipRows = document.querySelectorAll('.ship-row');
            const allShipItems = document.querySelectorAll('.ship-item');

            const visibleShipNumbers = [];
            allShipRows.forEach((row) => {
                const shipNumber = parseInt(row.getAttribute('data-ship-number'));
                const navio = naviosReais[shipNumber - 1];

                // Verificar filtro de classe
                const passaFiltroClasse = navio && (classe === 'Todas' || navio.classe === classe);

                // Verificar filtro de cor (se ativo)
                let passaFiltroCor = true;
                if (currentColorFilter && navio) {
                    const shipStatus = calcularStatusResumo(navio.nome);
                    passaFiltroCor = shipStatus.includes(currentColorFilter);
                }

                if (passaFiltroClasse && passaFiltroCor) {
                    row.style.display = 'grid';
                    visibleShipNumbers.push(shipNumber);
                } else {
                    row.style.display = 'none';
                }
            });

            allShipItems.forEach((item) => {
                const shipNumber = parseInt(item.getAttribute('data-ship-number'));
                const navio = naviosReais[shipNumber - 1];
                if (navio && (classe === 'Todas' || navio.classe === classe)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });

            redistributeVisibleRows(visibleShipNumbers);

            updateFilteredStats();

            if (currentMode === 'compact') {
                addThirdAndFourthVerticalLines();
            }
        }

        function redistributeVisibleRows(visibleShipNumbers) {
            const systemsGrid = document.getElementById('systemsGrid');
            if (!systemsGrid) return;

            const columns = Array.from(systemsGrid.querySelectorAll('.column-container'));
            if (columns.length === 0) return;

            const numColunas = columns.length;

            // Coletar TODOS os rows de todas as colunas
            const allRows = [];
            columns.forEach(col => {
                const rows = col.querySelectorAll('.ship-row.compact-mode');
                rows.forEach(row => allRows.push(row));
            });

            // Separar visíveis e ocultos
            const visibleRows = allRows.filter(row => row.style.display !== 'none');
            const hiddenRows = allRows.filter(row => row.style.display === 'none');

            // Ordenar visíveis por data-ship-number para manter ordem consistente
            visibleRows.sort((a, b) => {
                const numA = parseInt(a.getAttribute('data-ship-number')) || 0;
                const numB = parseInt(b.getAttribute('data-ship-number')) || 0;
                return numA - numB;
            });

            // Distribuição sequencial: primeira metade col0, segunda col1, etc.
            const porColuna2 = Math.ceil(visibleRows.length / numColunas);
            visibleRows.forEach((row, index) => {
                const columnIndex = Math.min(Math.floor(index / porColuna2), numColunas - 1);
                columns[columnIndex].appendChild(row);
            });

            // Adicionar ocultos na primeira coluna (não afeta layout visual)
            hiddenRows.forEach(row => {
                columns[0].appendChild(row);
            });
        }

        function updateFilteredStats() {
            let greenTotal = 0, yellowTotal = 0, redTotal = 0, grayTotal = 0;

            document.querySelectorAll('.ship-row').forEach((row) => {
                if (row.style.display !== 'none') {
                    const shipNumber = parseInt(row.getAttribute('data-ship-number'));
                    const navio = naviosReais[shipNumber - 1];

                    if (navio) {
                        const shipStatus = calcularStatusResumo(navio.nome);
                        shipStatus.forEach(status => {
                            if (status === 'green') greenTotal++;
                            else if (status === 'yellow') yellowTotal++;
                            else if (status === 'red') redTotal++;
                            else if (status === 'gray') grayTotal++;
                        });
                    }
                }
            });

            document.getElementById('greenCount').textContent = greenTotal;
            document.getElementById('yellowCount').textContent = yellowTotal;
            document.getElementById('redCount').textContent = redTotal;
            document.getElementById('grayCount').textContent = grayTotal;
        }

        function setViewMode(mode) {
            currentMode = mode;

            const dashboard = document.querySelector('.dashboard');
            const shipList = document.getElementById('shipList');
            const systemsGrid = document.getElementById('systemsGrid');
            const listaNaviosContainer = document.getElementById('listaNaviosContainer');
            const stats = document.querySelector('.stats');
            const btnHome = document.getElementById('btnHome');

            if (mode === 'normal') {
                dashboard.style.display = 'none';
                listaNaviosContainer.classList.add('active');
                if (stats) stats.style.display = 'none';
                if (btnHome) btnHome.style.display = 'flex';
                renderListaNavios();

            } else {
                dashboard.style.display = 'grid';
                listaNaviosContainer.classList.remove('active');
                if (stats) stats.style.display = 'flex';
                if (btnHome) btnHome.style.display = 'flex';

                dashboard.classList.add('compact');
                shipList.classList.add('compact');
                systemsGrid.classList.add('compact');

                reorganizeCompactLayout();
            }

            if (mode === 'compact') {
                const shipItems = document.querySelectorAll('.ship-item');
                const shipRows = document.querySelectorAll('.ship-row');
                const shipNames = document.querySelectorAll('.ship-name');
                const statusIndicators = document.querySelectorAll('.status-indicators');
                const statusCircles = document.querySelectorAll('.status-circle');

                shipItems.forEach(item => item.classList.add('compact-mode'));
                shipRows.forEach(row => row.classList.add('compact-mode'));
                shipNames.forEach(name => name.classList.add('compact-mode'));
                statusIndicators.forEach(indicator => indicator.classList.add('compact-mode'));
                statusCircles.forEach(circle => circle.classList.add('compact-mode'));

                const filterContainer = document.querySelector('.filter-dropdown-container');
                const filterBtn = document.querySelector('.filter-dropdown-btn');
                if (filterContainer) filterContainer.classList.add('compact-mode');
                if (filterBtn) filterBtn.classList.add('compact-mode');
            }
        }

        // Função para voltar para a tela de monitoramento (Home)
        function voltarParaHome() {
            // Limpar filtro de cor
            currentColorFilter = null;
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('active-filter');
            });

            // Limpar filtro de classe
            currentClassFilter = [];

            // Resetar modo privacidade para 0 (tudo visível)
            privacyMode = 0;
            const btnPrivacy = document.getElementById('btnPrivacy');
            if (btnPrivacy) {
                btnPrivacy.classList.remove('active');
                const svg = btnPrivacy.querySelector('svg');
                if (svg) {
                    svg.innerHTML = `<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>`;
                }
                const tooltip = btnPrivacy.querySelector('.tooltip-home');
                if (tooltip) {
                    tooltip.textContent = 'Ocultar nomes';
                }
            }

            // Restaurar textos originais e remover classes
            document.querySelectorAll('.crew-section').forEach(el => {
                if (el.hasAttribute('data-original-text')) {
                    el.innerHTML = el.getAttribute('data-original-text');
                    el.style.fontWeight = '';
                }
                el.classList.remove('censored');
                el.classList.remove('privacy-hidden');
            });
            document.querySelectorAll('.crew-header-section').forEach(el => {
                el.classList.remove('privacy-hidden');
            });

            // Remover modo ultra compacto
            const systemsGrid = document.querySelector('.systems-grid.compact');
            if (systemsGrid) {
                systemsGrid.classList.remove('ultra-compact');
                systemsGrid.classList.remove('privacy-compact');
            }

            // Atualizar contadores e estados visuais
            atualizarContadoresClasses();
            atualizarVisualFiltroClasse();

            // Voltar para monitoramento
            setViewMode('compact');

            // Reaplicar para mostrar todos
            applyAllFilters();
        }

        // Variável para armazenar qual categoria destacar
        let categoriaDestaque = null;

        function irParaPerfilNavio(index, categoriaIdx = null) {
            categoriaDestaque = categoriaIdx;
            setViewMode('normal');

            setTimeout(() => {
                selecionarNavio(index);

                // Se clicou em uma bolinha específica, destacar a categoria
                if (categoriaDestaque !== null) {
                    destacarCategoria(categoriaDestaque);
                }
            }, 100);
        }

        function destacarCategoria(categoriaIdx) {
            // Remover destaques anteriores
            document.querySelectorAll('.categoria-box').forEach(el => {
                el.classList.remove('categoria-destacada');
            });

            // Categorias: 0=Equipamentos, 1=Pessoal, 2=Certificação
            const categorias = document.querySelectorAll('.categoria-box');
            if (categorias[categoriaIdx]) {
                categorias[categoriaIdx].classList.add('categoria-destacada');

                // Scroll suave para a categoria
                categorias[categoriaIdx].scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Remover destaque após 3 segundos
                setTimeout(() => {
                    categorias[categoriaIdx].classList.remove('categoria-destacada');
                    categoriaDestaque = null;
                }, 3000);
            }
        }

        function renderListaNavios() {
            const container = document.getElementById('listaNaviosItems');
            if (!container) return;

            container.innerHTML = '';

            for (let i = 0; i < naviosReais.length; i++) {
                const navio = naviosReais[i];
                const item = document.createElement('div');
                item.className = 'navio-item';
                item.setAttribute('data-index', i);

                const nomeDiv = document.createElement('div');
                nomeDiv.className = 'navio-item-nome';
                nomeDiv.textContent = navio.nome;

                const classeDiv = document.createElement('div');
                classeDiv.className = 'navio-item-classe';
                classeDiv.textContent = navio.classe;

                item.appendChild(nomeDiv);
                item.appendChild(classeDiv);

                (function (index) {
                    item.onclick = function () {
                        selecionarNavio(index);
                    };
                })(i);

                container.appendChild(item);
            }
        }

        function selecionarNavio(index) {
            navioSelecionado = index;

            document.querySelectorAll('.navio-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });

            mostrarDetalhesNavio(index);
        }

        function mostrarDetalhesNavio(index) {
            const navio = naviosReais[index];
            const navioData = dadosNaviosCompletos[index];

            const painel = document.getElementById('painelDetalhes');

            // Buscar dados de indicadores do navio (IDO-SD, Reqs, SRs)
            const dadosDemo = dadosIndicadores[navio.nome] || {
                idoSD: 0,
                reqsOutstanding: 0,
                srsOutstanding: 0
            };

            const statusDetalhado = getStatusNavio(navio.nome);

            const equipamentosItems = [
                "Motor principal", "MCAs", "Grupo destilatório",
                "Equip. fundeio, amarração e guindastes", "Caldeira auxiliar",
                "DGE E BBA incêndio emergência", "Sistema de carga e descarga",
                "Máquina do leme", "Purificadores", "Sistemas de navegação",
                "Estado geral convés", "Estado geral PM"
            ];
            const equipamentosHTML = equipamentosItems.map(item =>
                gerarItemCategoria(item, statusDetalhado.equipamentos[item])
            ).join('');

            const pessoalItems = ["Trifix %", "Tripulantes vencidos", "Crew Matrix", "Certificação de Tripulante"];
            const pessoalHTML = pessoalItems.map(item =>
                gerarItemCategoria(item, statusDetalhado.pessoal[item])
            ).join('');

            const certificacaoItems = ["Pendência de Documentação Navio", "Condição de classe", "Obs Vetting"];
            const certificacaoHTML = certificacaoItems.map(item =>
                gerarItemCategoria(item, statusDetalhado.certificacao[item])
            ).join('');

            painel.innerHTML = `
                <div class="detalhes-header">
                    <div class="navio-titulo-box">${navio.nome}</div>
                    <div class="ido-circle">
                        <div class="ido-label">IDO-SD</div>
                        <div class="ido-valor">${dadosDemo.idoSD}%</div>
                    </div>
                    <div class="info-cards-header">
                        <p><strong>Reqs outstanding:</strong> ${dadosDemo.reqsOutstanding}</p>
                        <p><strong>SRs outstanding:</strong> ${dadosDemo.srsOutstanding}</p>
                    </div>
                </div>

                <div class="categorias-container">
                    <!-- Equipamentos -->
                    <div class="categoria-box">
                        <div class="categoria-titulo">Equipamentos</div>
                        <div class="categoria-items">
                            ${equipamentosHTML}
                        </div>
                    </div>

                    <!-- Pessoal -->
                    <div class="categoria-box">
                        <div class="categoria-titulo">Pessoal</div>
                        <div class="categoria-items">
                            ${pessoalHTML}
                        </div>
                    </div>

                    <!-- Certificação -->
                    <div class="categoria-box">
                        <div class="categoria-titulo">Certificação</div>
                        <div class="categoria-items">
                            ${certificacaoHTML}
                        </div>
                    </div>
                </div>
            `;

            setTimeout(configurarTooltips, 50);
        }

        function reorganizeNormalLayout() {
            const systemsGrid = document.getElementById('systemsGrid');
            const allRows = Array.from(systemsGrid.querySelectorAll('.ship-row'));

            systemsGrid.innerHTML = '';

            // Manter ordem original (já está correta por classe)
            // Remover compact-ship-info de cada row e ESCONDER bolinhas no modo normal
            allRows.forEach(row => {
                const compactInfo = row.querySelector('.compact-ship-info');
                if (compactInfo) {
                    compactInfo.remove();
                }

                // Esconder bolinhas no modo normal
                const indicators = row.querySelector('.status-indicators');
                if (indicators) {
                    indicators.style.display = 'none';
                }

                systemsGrid.appendChild(row);
            });

            const verticalLines = document.querySelectorAll('.vertical-line-3, .vertical-line-4');
            verticalLines.forEach(line => line.remove());
        }

        function reorganizeCompactLayout() {
            const systemsGrid = document.getElementById('systemsGrid');
            const allRows = Array.from(systemsGrid.querySelectorAll('.ship-row'));

            // Garantir sempre a ordem correta (Panamax → Aframax → Suezmax → Produtos → Gaseiro 7k → Gaseiro 4k)
            // independente de qualquer reorganização anterior feita pelo botão do olho ou filtros
            allRows.sort((a, b) => {
                const numA = parseInt(a.getAttribute('data-ship-number')) || 0;
                const numB = parseInt(b.getAttribute('data-ship-number')) || 0;
                return numA - numB;
            });

            // Manter a ordem original (já está correta por classe)
            systemsGrid.innerHTML = '';

            // Criar duas colunas
            const leftColumn = document.createElement('div');
            leftColumn.className = 'column-container';

            const rightColumn = document.createElement('div');
            rightColumn.className = 'column-container';

            // Criar header para coluna esquerda
            const leftHeader = document.createElement('div');
            leftHeader.className = 'compact-column-header';
            leftHeader.innerHTML = `
                <div class="compact-header-name" onclick="toggleFilterPopup()" style="cursor: pointer;" title="Clique para filtrar">
                    <svg class="filter-icon-header" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 5px; opacity: 0.6;">
                        <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z"/>
                    </svg>
                    Navio
                </div>
                <div class="compact-header-section crew-header-section" title="Comandante">CMT</div>
                <div class="compact-header-section crew-header-section" title="Chefe de Máquinas">CFM</div>
                <div class="compact-header-section crew-header-section" title="Imediato">IMT</div>
                <div class="compact-header-section compact-header-idade" title="Idade da Embarcação">IDADE</div>
                <span class="classe-filter-badge"></span>
            `;
            leftColumn.appendChild(leftHeader);

            // Criar header para coluna direita
            const rightHeader = document.createElement('div');
            rightHeader.className = 'compact-column-header';
            rightHeader.innerHTML = `
                <div class="compact-header-name" onclick="toggleFilterPopup()" style="cursor: pointer;" title="Clique para filtrar">
                    <svg class="filter-icon-header" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 5px; opacity: 0.6;">
                        <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z"/>
                    </svg>
                    Navio
                </div>
                <div class="compact-header-section crew-header-section" title="Comandante">CMT</div>
                <div class="compact-header-section crew-header-section" title="Chefe de Máquinas">CFM</div>
                <div class="compact-header-section crew-header-section" title="Imediato">IMT</div>
                <div class="compact-header-section compact-header-idade" title="Idade da Embarcação">IDADE</div>
                <span class="classe-filter-badge"></span>
            `;
            rightColumn.appendChild(rightHeader);

            const porColuna0 = Math.ceil(allRows.length / 2);
            allRows.forEach((row, index) => {
                const shipNumber = parseInt(row.getAttribute('data-ship-number'));
                const navioData = dadosNaviosCompletos[shipNumber - 1];

                const oldInfo = row.querySelector('.compact-ship-info');
                if (oldInfo) {
                    oldInfo.remove();
                }

                const indicators = row.querySelector('.status-indicators');
                if (indicators) {
                    indicators.style.display = 'flex';
                }

                const textDiv = document.createElement('div');
                textDiv.className = 'compact-ship-info';

                const shipNameText = navioData?.nome || naviosReais[shipNumber - 1]?.nome || '';

                const tripulacao = tripulacaoNavios[shipNameText] || {};

                const cmtDiv = document.createElement('div');
                cmtDiv.className = 'compact-text-section crew-section';
                const cmtData = tripulacao.CMT || '-';
                const cmtMat = tripulacao.CMT_MAT || '';
                cmtDiv.innerHTML = cmtData;
                if (cmtMat && cmtData !== '-') {
                    cmtDiv.title = 'Matrícula: ' + cmtMat;
                    cmtDiv.style.cursor = 'help';
                }

                const cfmDiv = document.createElement('div');
                cfmDiv.className = 'compact-text-section crew-section';
                const cfmData = tripulacao.CFM || '-';
                const cfmMat = tripulacao.CFM_MAT || '';
                cfmDiv.innerHTML = cfmData;
                if (cfmMat && cfmData !== '-') {
                    cfmDiv.title = 'Matrícula: ' + cfmMat;
                    cfmDiv.style.cursor = 'help';
                }

                const imtDiv = document.createElement('div');
                imtDiv.className = 'compact-text-section crew-section';
                const imtData = tripulacao.IMT || '-';
                const imtMat = tripulacao.IMT_MAT || '';
                imtDiv.innerHTML = imtData;
                if (imtMat && imtData !== '-') {
                    imtDiv.title = 'Matrícula: ' + imtMat;
                    imtDiv.style.cursor = 'help';
                }

                // Criar seção de IDADE
                const idadeDiv = document.createElement('div');
                idadeDiv.className = 'compact-text-section idade-section';
                const ageData = calculateShipAge(shipNameText);
                idadeDiv.textContent = ageData.years !== '-' ? ageData.years + ' anos' : '-';
                idadeDiv.title = ageData.days !== '-' ? shipBirthDates[shipNameText.toUpperCase()] : 'Data não disponível';

                textDiv.appendChild(cmtDiv);
                textDiv.appendChild(cfmDiv);
                textDiv.appendChild(imtDiv);
                textDiv.appendChild(idadeDiv);

                // Inserir após ship-name (segundo elemento do row)
                const shipName = row.children[0]; // Primeiro filho é ship-name
                shipName.after(textDiv);

                const colIdx = Math.min(Math.floor(index / porColuna0), 1);
                if (colIdx === 0) {
                    leftColumn.appendChild(row);
                } else {
                    rightColumn.appendChild(row);
                }
            });

            systemsGrid.appendChild(leftColumn);
            systemsGrid.appendChild(rightColumn);

            // Adicionar linhas 3 e 4 (após CFM e IMT) via JavaScript com delay
            setTimeout(() => {
                addThirdAndFourthVerticalLines();
            }, 100);
        }

        function addThirdAndFourthVerticalLines() {
            // Não faz nada — divisores tratados via CSS
        }

        // ══════════════════════════════════════════════════════
        //  CHEAT CODE — "Gabina é o máximo"
        //  Sequência: logo×2 → home×2 → logo×2
        //  Qualquer clique fora da sequência reseta o progresso
        // ══════════════════════════════════════════════════════
        (function () {
            const SEQUENCIA = ['logo', 'logo', 'home', 'home', 'logo', 'logo'];
            let passo = 0;
            let cheatAtivo = false;
            let textoOriginal = null;

            function registrarClique(elemento) {
                if (cheatAtivo) return;

                if (SEQUENCIA[passo] === elemento) {
                    passo++;
                    if (passo === SEQUENCIA.length) {
                        ativarCheat();
                        passo = 0;
                    }
                } else {
                    // Clique errado — verifica se o elemento reinicia a sequência
                    passo = (SEQUENCIA[0] === elemento) ? 1 : 0;
                }
            }

            function ativarCheat() {
                cheatAtivo = true;
                textoOriginal = [];

                const walker = document.createTreeWalker(
                    document.body,
                    NodeFilter.SHOW_TEXT,
                    {
                        acceptNode: function (node) {
                            const pai = node.parentElement;
                            if (!pai) return NodeFilter.FILTER_REJECT;
                            const tag = pai.tagName.toUpperCase();
                            if (['SCRIPT', 'STYLE', 'SVG', 'PATH', 'DEFS', 'G'].includes(tag)) return NodeFilter.FILTER_REJECT;
                            if (node.textContent.trim() === '') return NodeFilter.FILTER_SKIP;
                            return NodeFilter.FILTER_ACCEPT;
                        }
                    }
                );

                let no;
                while ((no = walker.nextNode())) {
                    textoOriginal.push({ node: no, valor: no.textContent });
                    no.textContent = 'Gabina é o máximo';
                }

                // Flash dourado
                document.body.style.transition = 'background 0.4s';
                document.body.style.background = 'radial-gradient(circle, #ffd700 0%, #1a2a4a 60%)';
                setTimeout(() => { document.body.style.background = ''; }, 600);

                console.log('%c🏆 CHEAT ATIVADO! Gabina é o máximo! 🏆', 'color: gold; font-size: 18px; font-weight: bold;');

                // Restaura após 5 segundos
                setTimeout(desativarCheat, 5000);
            }

            function desativarCheat() {
                if (!textoOriginal) return;
                textoOriginal.forEach(function (item) {
                    try { item.node.textContent = item.valor; } catch (e) { }
                });
                textoOriginal = null;
                cheatAtivo = false;
            }

            function inicializar() {
                const logo = document.querySelector('.header-logo');
                const home = document.getElementById('btnHome');

                if (!logo || !home) {
                    setTimeout(inicializar, 200);
                    return;
                }

                logo.addEventListener('click', function (e) {
                    e.stopPropagation();
                    registrarClique('logo');
                }, true);

                home.addEventListener('click', function (e) {
                    e.stopPropagation();
                    registrarClique('home');
                }, true);

                // Qualquer clique em outro lugar reseta a sequência
                document.addEventListener('click', function (e) {
                    if (!e.target.closest('.header-logo, #btnHome')) {
                        passo = 0;
                    }
                }, true);
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', inicializar);
            } else {
                inicializar();
            }
        })();

    </script>
</body>

</html>
